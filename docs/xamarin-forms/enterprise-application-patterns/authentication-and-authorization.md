---
title: ะััะตะฝัะธัะธะบะฐัะธั ะธ ะฐะฒัะพัะธะทะฐัะธั
description: ะ ะดะฐะฝะฝะพะน ะณะปะฐะฒะต ะพะฑัััะฝัะตััั, ะบะฐะบ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต eShopOnContainers ะฒัะฟะพะปะฝัะตั ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธั ะดะปั ะบะพะฝัะตะนะฝะตัะฝัั ะผะธะบัะพัะปัะถะฑ.
ms.prod: xamarin
ms.assetid: e3f27b4c-f7f5-4839-a48c-30bcb919c59e
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 08/08/2017
ms.openlocfilehash: 9db9902dfbf602ba21b353f3a17920dc37b03ee5
ms.sourcegitcommit: a1a58afea68912c79d16a3f64de9a0c1feb2aeb4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2019
ms.locfileid: "55234008"
---
# <a name="authentication-and-authorization"></a>ะััะตะฝัะธัะธะบะฐัะธั ะธ ะฐะฒัะพัะธะทะฐัะธั

ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ โ ััะพ ะฟัะพัะตัั ะฟะพะปััะตะฝะธั ััะตัะฝัั ะดะฐะฝะฝัั ะธะดะตะฝัะธัะธะบะฐัะธะธ, ัะฐะบะธะต ะบะฐะบ ะธะผั ะธ ะฟะฐัะพะปั ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะฟัะพะฒะตัะบะธ ััะธั ััะตัะฝัั ะดะฐะฝะฝัั ะฝะฐ ะฝะฐะปะธัะธะต ะฟะพะปะฝะพะผะพัะธะน. ะัะปะธ ััะตัะฝัะต ะดะฐะฝะฝัะต ะดะตะนััะฒะธัะตะปัะฝั, ัััะฝะพััั, ะบะพัะพัะฐั ะพัะฟัะฐะฒะปะตะฝะฐ ััะตัะฝัะต ะดะฐะฝะฝัะต, ััะธัะฐะตััั ะฟัะพัะตะดัะธะผ ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ. ะะพัะปะต ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะดะพััะพะฒะตัะตะฝะธั ะฟัะพัะตัั ะฐะฒัะพัะธะทะฐัะธะธ ะพะฟัะตะดะตะปัะตั, ะธะผะตะตั ะปะธ ััะพ ัะดะพััะพะฒะตัะตะฝะธะต ะดะพัััะฟ ะบ ะบะพะฝะบัะตัะฝะพะผั ัะตััััั.

ะกััะตััะฒัะตั ะผะฝะพะณะพ ะฟะพะดัะพะดะพะฒ ะบ ะธะฝัะตะณัะฐัะธะธ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ ะฒ ะฟัะธะปะพะถะตะฝะธะต Xamarin.Forms, ะบะพัะพัะพะต ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั ASP.NET MVC, ะฒะบะปััะฐั ะฟะพััะฐะฒัะธะบะพะฒ ะฒะฝะตัะฝะตะน ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะฝะฐะฟัะธะผะตั Microsoft, Google, ั ะฟะพะผะพััั ASP.NET Core Identity Facebook ะธะปะธ Twitter ะธ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั. ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ะฒัะฟะพะปะฝัะตั ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ ั ะฟะพะผะพััั ะผะธะบัะพัะปัะถะฑั ะบะพะฝัะตะนะฝะตัะฝัั ัะดะพััะพะฒะตัะตะฝะธะน, ะบะพัะพัะฐั ะธัะฟะพะปัะทัะตั IdentityServer 4. ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะทะฐะฟัะฐัะธะฒะฐะตั ั IdentityServer, ะผะฐัะบะตัั ะฑะตะทะพะฟะฐัะฝะพััะธ, ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะปะธ ะดะปั ะดะพัััะฟะฐ ะบ ัะตััััั. ะะปั IdentityServer ะดะปั ะฒัะดะฐัะธ ะผะฐัะบะตัะพะฒ ะพั ะธะผะตะฝะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะปัะทะพะฒะฐัะตะปั ะดะพะปะถะตะฝ ะฒะพะนัะธ ะฒ ะบ IdentityServer. ะขะตะผ ะฝะต ะผะตะฝะตะต ัะตัะฒะตั ะฝะต ะฟัะตะดะพััะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะน ะธะฝัะตััะตะนั ะธะปะธ ะฑะฐะทั ะดะฐะฝะฝัั ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะฒ ะพะฑัะฐะทัะต ะฟัะธะปะพะถะตะฝะธั eShopOnContainers, ะดะปั ััะพะน ัะตะปะธ ะธัะฟะพะปัะทัะตััั ัะดะพััะพะฒะตัะตะฝะธะต ASP.NET Core.

## <a name="authentication"></a>ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ

ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ ะฝะตะพะฑัะพะดะธะผะฐ, ะตัะปะธ ะฟัะธะปะพะถะตะฝะธั ะดะพะปะถะฝะพ ะฑััั ะธะทะฒะตััะฝะพ ัะดะพััะพะฒะตัะตะฝะธะต ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั. ASP.NET Core ะพัะฝะพะฒะฝัะผ ะผะตัะฐะฝะธะทะผะพะผ ะดะปั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะฒะปัะตััั ัะธััะตะผะฐ ัะปะตะฝััะฒะฐ ASP.NET Core Identity, ะบะพัะพัะฐั ััะฐะฝะธั ัะฒะตะดะตะฝะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะฒ ััะฐะฝะธะปะธัะต ะดะฐะฝะฝัั, ะฝะฐัััะพะตะฝะฝะพะผ ัะฐะทัะฐะฑะพััะธะบะพะผ. ะะฐะบ ะฟัะฐะฒะธะปะพ ััะพ ััะฐะฝะธะปะธัะต ะดะฐะฝะฝัั ะฑัะดะตั ััะฐะฝะธะปะธัะต EntityFramework, ัะพัั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะต ััะฐะฝะธะปะธัะฐ ะธะปะธ ะฟะฐะบะตัั ััะพัะพะฝะฝะธั ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ัะดะพััะพะฒะตัะตะฝะธะน ะฒ ััะฐะฝะธะปะธัะต Azure, Azure Cosmos DB ะธะปะธ ะดััะณะธั ะผะตััะฐั.

ะกัะตะฝะฐัะธะธ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะบะพัะพััะต ะดะตะปะฐัั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ััะฐะฝะธะปะธัะฐ ะดะฐะฝะฝัั ะปะพะบะฐะปัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั, ะธ ะบะพัะพััะต ัะพััะฐะฝััััั ัะฒะตะดะตะฝะธั ะพะฑ ัะดะพััะพะฒะตัะตะฝะธัั ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ ั ะฟะพะผะพััั ัะฐะนะปะพะฒ cookie (ะบะฐะบ ะพะฑััะฝะพ ะฑัะฒะฐะตั ะฒ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะน ASP.NET MVC), ัะดะพััะพะฒะตัะตะฝะธะต ASP.NET Core โ ััะพ ะฟะพะดัะพะดััะตะต ัะตัะตะฝะธะต. ะขะตะผ ะฝะต ะผะตะฝะตะต ัะฐะนะปั cookie ะฝะต ะฒัะตะณะดะฐ ะฝะตัะตะปะตัะพะพะฑัะฐะทะฝะพ ััะฐะฝะธัั ะธ ะฟะตัะตะดะฐะฒะฐัั ะดะฐะฝะฝัะต. ะะฐะฟัะธะผะตั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ASP.NET Core, ะบะพัะพัะฐั ะฟัะตะดะพััะฐะฒะปัะตั RESTful ะบะพะฝะตัะฝัั ัะพัะตะบ, ะดะพัััะฟะฝัั ะธะท ะผะพะฑะธะปัะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั ะพะฑััะฝะพ ััะตะฑัะตััั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะพะบะตะฝะฐ ะฝะพัะธัะตะปั, ัะฐะบ ะบะฐะบ ัะฐะนะปั cookie ะฝะต ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะฒ ััะพะผ ััะตะฝะฐัะธะธ. ะขะตะผ ะฝะต ะผะตะฝะตะต ัะพะบะตะฝั ะฝะพัะธัะตะปั ะผะพะถะฝะพ ะปะตะณะบะพ ะฟะพะปััะฐัั ะธ ัะพะดะตัะถะธััั ะฒ ะทะฐะณะพะปะพะฒะบะต ะฐะฒัะพัะธะทะฐัะธะธ ะฒะตะฑ-ะทะฐะฟัะพัะพะฒ, ัะดะตะปะฐะฝะฝัั ะฒ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ.

### <a name="issuing-bearer-tokens-using-identityserver-4"></a>ะัะดะฐะตั ะผะฐัะบะตัั ะฝะพัะธัะตะปั, ั ะฟะพะผะพััั IdentityServer 4

[IdentityServer 4](https://github.com/IdentityServer/IdentityServer4) โ ััะตะนะผะฒะพัะบ ั ะพัะบััััะผ ะบะพะดะพะผ OpenID Connect ะธ OAuth 2.0 ะดะปั ASP.NET Core, ะบะพัะพััะน ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะผะฝะพะณะธั ััะตะฝะฐัะธะตะฒ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ, ะฒะบะปััะฐั ะฒัะดะฐะตั ะผะฐัะบะตัั ะฑะตะทะพะฟะฐัะฝะพััะธ ะดะปั ะปะพะบะฐะปัะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะดะพััะพะฒะตัะตะฝะธั ASP.NET Core.

> [!NOTE]
> OpenID Connect ะธ OAuth 2.0 ะพัะตะฝั ะฟะพัะพะถะธ, ะธะผะตั ัะฐะทะปะธัะฝัะต ะพะฑัะทะฐะฝะฝะพััะธ.

OpenID Connect ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ััะพะฒะตะฝั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฝะฐ ะพัะฝะพะฒะต ะฟัะพัะพะบะพะปะฐ OAuth 2.0. OAuth 2 โ ััะพ ะฟัะพัะพะบะพะป, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั ะฟัะธะปะพะถะตะฝะธัะผ ะทะฐะฟัะฐัะธะฒะฐัั ะผะฐัะบะตัั ะดะพัััะฟะฐ ะพั ัะปัะถะฑั ะผะฐัะบะตัะพะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ ะธ ะธัะฟะพะปัะทะพะฒะฐัั ะธั ะดะปั ะฒะทะฐะธะผะพะดะตะนััะฒะธั ั ะธะฝัะตััะตะนัะฐะผะธ API. ะญัะพ ะดะตะปะตะณะธัะพะฒะฐะฝะธะต ัะฝะธะถะฐะตั ัะปะพะถะฝะพััั ะฒ ะบะปะธะตะฝััะบะธะต ะฟัะธะปะพะถะตะฝะธั ะธ ะธะฝัะตััะตะนัั API, ัะฐะบ ะบะฐะบ ะผะพะถะฝะพ ะฑััั ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะน ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ.

ะกะพัะตัะฐะฝะธะต OpenID Connect ะธ OAuth 2.0 ะพะฑัะตะดะธะฝะธัั ะดะฒะต ะฟัะพะฑะปะตะผั ะพัะฝะพะฒะพะฟะพะปะฐะณะฐััะธั ะฟัะธะฝัะธะฟะพะฒ ะพะฑะตัะฟะตัะตะฝะธั ะฑะตะทะพะฟะฐัะฝะพััะธ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะดะพัััะฟะฐ ะบ API ะธ IdentityServer 4 ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ัะตะฐะปะธะทะฐัะธั ััะธั ะฟัะพัะพะบะพะปะพะฒ.

ะ ะฟัะธะปะพะถะตะฝะธัั, ะธัะฟะพะปัะทัััะธั ะฟััะผะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ะบะปะธะตะฝัะฐ ั ะผะธะบัะพัะปัะถะฑะพะน, ัะฐะบะธั ะบะฐะบ ะฟัะธะปะพะถะตะฝะธั eShopOnContainers ะฒัะดะตะปะตะฝะฝะฐั ะผะธะบัะพัะปัะถะฑะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ ะฒััััะฟะฐะตั ะฒ ะบะฐัะตััะฒะต ัะพะบะตะฝะพะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ ัะปัะถะฑั (STS) ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฝะฐ ัะธั. 9-1. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟััะผะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ะบะปะธะตะฝัะฐ ั ะผะธะบัะพัะปัะถะฑะพะน, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะพะฑะผะตะฝ ะดะฐะฝะฝัะผะธ ะผะตะถะดั ะบะปะธะตะฝัะพะผ ะธ ะะธะบัะพัะปัะถะฑ](~/xamarin-forms/enterprise-application-patterns/containerized-microservices.md#communication_between_client_and_microservices).

![](authentication-and-authorization-images/authentication.png "ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ ั ะฒัะดะตะปะตะฝะฝะฐั ะผะธะบัะพัะปัะถะฑะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ")

**ะะธั. 9-1.** ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ ั ะฒัะดะตะปะตะฝะฝะฐั ะผะธะบัะพัะปัะถะฑะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ

ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะผะธะบัะพัะปัะถะฑั ะฟะพ ะธะดะตะฝัะธัะธะบะฐัะธะธ, ะบะพัะพััะน ะธัะฟะพะปัะทัะตั 4 identityserver ะดะพะปะถะฝะพ ะฒัะฟะพะปะฝััั ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะบะพะฝััะพะปั ะดะพัััะฟะฐ ะดะปั ะธะฝัะตััะตะนัะพะฒ API. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะทะฐะฟัะฐัะธะฒะฐะตั ะผะฐัะบะตัั ั IdentityServer, ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะปะธ ะดะปั ะดะพัััะฟะฐ ะบ ัะตััััั:

-   ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั identityserver ะดะพะปะถะฝะพ ะดะพััะธะณะฐะตััั ะทะฐะฟัะพัะธะฒ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต *ัะดะพััะพะฒะตัะตะฝะธะน* ะผะฐัะบะตั, ะบะพัะพััะน ะฟัะตะดััะฐะฒะปัะตั ัะตะทัะปััะฐั ะฟัะพัะตััะฐ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ. ะะธะฝะธะผัะผ ะพะฝ ัะพะดะตัะถะธั ะธะดะตะฝัะธัะธะบะฐัะพั ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ัะฒะตะดะตะฝะธั ะพ ัะพะผ, ะบะฐะบ ะธ ะบะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟัะพัะตะป ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ. ะะฝ ัะฐะบะถะต ะผะพะถะตั ัะพะดะตัะถะฐัั ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะธะดะตะฝัะธัะธะบะฐัะธะพะฝะฝัั ะดะฐะฝะฝัั.
-   ะะพัััะฟ ะบ ัะตััััั ั identityserver ะดะพะปะถะฝะพ ะดะพััะธะณะฐะตััั ะทะฐะฟัะพัะธะฒ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต *ะดะพัััะฟะฐ* ะผะฐัะบะตั, ะบะพัะพััะน ัะฐะทัะตัะฐะตั ะดะพัััะฟ ะบ ัะตััััั API. ะะปะธะตะฝัั, ะทะฐะฟัะพัะฐ ะผะฐัะบะตัะพะฒ ะดะพัััะฟะฐ ะธ ะฟะตัะตััะปะฐัั ะธั ะฒ API. ะะฐัะบะตัั ะดะพัััะฟะฐ ัะพะดะตัะถะฐั ัะฒะตะดะตะฝะธั ะพ ะบะปะธะตะฝัะต ะธ ะฟะพะปัะทะพะฒะฐัะตะปั (ะฟัะธ ะตะณะพ ะฝะฐะปะธัะธะธ). API-ะธะฝัะตััะตะนัั, ะทะฐัะตะผ ะธัะฟะพะปัะทะพะฒะฐัั ััั ะธะฝัะพัะผะฐัะธั ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ ะดะพัััะฟะฐ ะบ ะธั ะดะฐะฝะฝัะผ.

> [!NOTE]
> ะะปะธะตะฝัะฐ ะดะพะปะถะตะฝ ะฑััั ะทะฐัะตะณะธัััะธัะพะฒะฐะฝ ั identityserver ะดะพะปะถะฝะพ, ะฟัะตะถะดะต ัะตะผ ะพะฝ ะผะพะถะตั ะทะฐะฟัะฐัะธะฒะฐัั ะผะฐัะบะตัั.

### <a name="adding-identityserver-to-a-web-application"></a>ะะพะฑะฐะฒะปะตะฝะธะต IdentityServer ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต

ะงัะพะฑั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ASP.NET Core ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั IdentityServer 4 ะตะณะพ ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั ะฒ ัะตัะตะฝะธะต Visual Studio ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ะะฑะทะพั](https://identityserver4.readthedocs.io/en/latest/quickstarts/0_overview.html) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer.

ะะพัะปะต IdentityServer ะฒะบะปััะตะฝ ะฒ ัะตัะตะฝะธะต Visual Studio ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั, ะตะณะพ ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั ะฒ ะบะพะฝะฒะตะนะตั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ HTTP ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั, ััะพะฑั ะพะฝะฐ ะผะพะถะตั ะฒัะฟะพะปะฝััั ะทะฐะฟัะพัั ะบ ะบะพะฝะตัะฝัะผ ัะพัะบะฐะผ OpenID Connect ะธ OAuth 2.0. ะญัะพ ะผะพะถะฝะพ ัะดะตะปะฐัั ะฒ `Configure` ะผะตัะพะด ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั `Startup` ะบะปะฐััะฐ, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
publicยvoidยConfigure(  
ยยยยIApplicationBuilderยapp,ยIHostingEnvironmentยenv,ยILoggerFactoryยloggerFactory)  
{  
ยยยย...  
ยยยยapp.UseIdentity();  
ยยยย...  
}
```

ะะพััะดะพะบ ะธะผะตะตั ะทะฝะฐัะตะฝะธะต ะฒ ะบะพะฝะฒะตะนะตั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ HTTP ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ IdentityServer ะดะพะปะถะฝั ะดะพะฑะฐะฒะปััััั ะฒ ะบะพะฝะฒะตะนะตั, ะฟัะตะถะดะต ัะตะผ ะฟะปะฐััะพัะผะฐ ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ะธะฝัะตััะตะนัะฐ, ะบะพัะพััะน ัะตะฐะปะธะทัะตั ัะบัะฐะฝ ะฒัะพะดะฐ.

### <a name="configuring-identityserver"></a>ะะฐัััะพะนะบะฐ IdentityServer

IdentityServer ะดะพะปะถะฝะพ ะฑััั ะฝะฐัััะพะตะฝะพ ะฒ `ConfigureServices` ะผะตัะพะด ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั `Startup` ะบะปะฐัั ะฟััะตะผ ะฒัะทะพะฒะฐ `services.AddIdentityServer` ะผะตัะพะด, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ ะธะท ััะฐะปะพะฝะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั eShopOnContainers:

```csharp
publicยvoidยConfigureServices(IServiceCollectionยservices)  
{  
ยยยย...  
ยยยยservices.AddIdentityServer(xย=>ยx.IssuerUriย=ย"null")  
ยยยยยยยย.AddSigningCredential(Certificate.Get())ยยยยยยยยยยยยยยย  
ยยยยยยยย.AddAspNetIdentity<ApplicationUser>()  
ยยยยยยยย.AddConfigurationStore(builderย=>  
ยยยยยยยยยยยยbuilder.UseSqlServer(connectionString,ยoptionsย=>  
ยยยยยยยยยยยยยยยยoptions.MigrationsAssembly(migrationsAssembly)))  
ยยยยยยยย.AddOperationalStore(builderย=>  
ยยยยยยยยยยยยbuilder.UseSqlServer(connectionString,ยoptionsย=>  
ยยยยยยยยยยยยยยยยoptions.MigrationsAssembly(migrationsAssembly)))  
ยยยยยยยย.Services.AddTransient<IProfileService,ยProfileService>();  
}
```

ะะพัะปะต ะฒัะทะพะฒะฐ ะผะตัะพะดะฐ `services.AddIdentityServer` ะผะตัะพะด, ะฝะฐัััะพะนัะต ัะปะตะดัััะธะต ะบะพะผะฟะพะฝะตะฝัั ะฝะฐะทัะฒะฐัััั ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตะบััะตะณะพ API:

-   ะฃัะตัะฝัะต ะดะฐะฝะฝัะต, ะธัะฟะพะปัะทัะตะผัะต ะดะปั ะฟะพะดะฟะธััะฒะฐะฝะธั.
-   ะะตััััั API ะธ ัะดะพััะพะฒะตัะตะฝะธะน, ะบะพัะพััะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะทะฐะฟัะฐัะธะฒะฐัั ะดะพัััะฟ ะบ.
-   ะะปะธะตะฝัั, ะบะพัะพััะต ะฑัะดัั ะฟะพะดะบะปััะฐัััั ะดะปั ะทะฐะฟัะพัะฐ ะผะฐัะบะตัะพะฒ.
-   ะฃะดะพััะพะฒะตัะตะฝะธะต ASP.NET Core.

>๐ก **ะกะพะฒะตั**: ะะธะฝะฐะผะธัะตัะบะธ ะะฐะณััะทะธัะต ะบะพะฝัะธะณััะฐัะธั IdentityServer 4. IdentityServer 4 API-ะธะฝัะตััะตะนัั ะฟะพะทะฒะพะปััั ะฝะฐัััะพะธัั ัะตัะฒะตั ะธะท ัะฟะธัะบะฐ ะฒ ะฟะฐะผััะธ ะพะฑัะตะบัะพะฒ ะบะพะฝัะธะณััะฐัะธะธ. ะ ะพะฑัะฐะทัะต ะฟัะธะปะพะถะตะฝะธั eShopOnContainers ััะธั ะบะพะปะปะตะบัะธะน ะฒ ะฟะฐะผััะธ ะถะตััะบะพ ะทะฐะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝั ะฒ ะฟัะธะปะพะถะตะฝะธะต. ะขะตะผ ะฝะต ะผะตะฝะตะต ะฒ ัะฐะฑะพัะธั ััะตะฝะฐัะธัั ะธั ะผะพะถะฝะพ ะทะฐะณััะทะธัั ะดะธะฝะฐะผะธัะตัะบะธ ะธะท ัะฐะนะปะฐ ะบะพะฝัะธะณััะฐัะธะธ ะธะปะธ ะธะท ะฑะฐะทั ะดะฐะฝะฝัั.

ะกะฒะตะดะตะฝะธั ะพ ะฝะฐัััะพะนะบะต identityserver ะดะพะปะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ัะดะพััะพะฒะตัะตะฝะธั ASP.NET Core, ัะผ. ะฒ ัะฐะทะดะตะปะต [ั ะฟะพะผะพััั ASP.NET Core Identity](https://identityserver4.readthedocs.io/en/latest/quickstarts/8_aspnet_identity.html) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer.

#### <a name="configuring-api-resources"></a>ะะฐัััะพะนะบะฐ ัะตััััะพะฒ API

ะัะธ ะฝะฐัััะพะนะบะต ัะตััััะพะฒ API `AddInMemoryApiResources` ะพะถะธะดะฐะตั, ััะพ ะผะตัะพะด `IEnumerable<ApiResource>` ะบะพะปะปะตะบัะธะธ. ะ ัะปะตะดัััะตะผ ะบะพะดะต ะฟะพะบะฐะทะฐะฝะพ ะฒ ะฟัะธะผะตัะต `GetApis` ะผะตัะพะด, ะบะพัะพััะน ัะพะดะตัะถะธั ััั ะบะพะปะปะตะบัะธั ะฝะฐ eShopOnContainers ะพะฑัะฐัะตะฝะธะต ะบ ะฟัะธะปะพะถะตะฝะธั:

```csharp
publicยstaticยIEnumerable<ApiResource>ยGetApis()  
{  
ยยยยreturnยnewยList<ApiResource>  
ยยยย{  
ยยยยยยยยnewยApiResource("orders",ย"OrdersยService"),  
ยยยยยยยยnewยApiResource("basket",ย"BasketยService")  
ยยยย};  
}
```

ะญัะพั ะผะตัะพะด ัะบะฐะทัะฒะฐะตั, ััะพ ัะตัะฒะตั ัะปะตะดัะตั ะทะฐัะธัะธัั, ะทะฐะบะฐะทะพะฒ ะธ ะบะพัะทะธะฝั API-ะธะฝัะตััะตะนัั. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, IdentityServer ัะฟัะฐะฒะปัะตะผัะน ะดะพัััะฟ ะผะฐัะบะตัั ะฑัะดัั ะฝะตะพะฑัะพะดะธะผั ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ ะฒัะทะพะฒะพะฒ ะบ ััะธะผ API. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ `ApiResource` ะฒะฒะตะดะธัะต, ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะตััััะฐ API](https://identityserver4.readthedocs.io/en/latest/reference/api_resource.html) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer 4.

#### <a name="configuring-identity-resources"></a>ะะฐัััะพะนะบะฐ ะธะดะตะฝัะธัะธะบะฐัะพัะพะฒ ัะตััััะพะฒ

ะัะธ ะฝะฐัััะพะนะบะต ัะตััััะพะฒ ัะดะพััะพะฒะตัะตะฝะธะน `AddInMemoryIdentityResources` ะพะถะธะดะฐะตั, ััะพ ะผะตัะพะด `IEnumerable<IdentityResource>` ะบะพะปะปะตะบัะธะธ. ะะตััััั ัะดะพััะพะฒะตัะตะฝะธะน โ ััะพ ะดะฐะฝะฝัะต, ะฝะฐะฟัะธะผะตั ะธะดะตะฝัะธัะธะบะฐัะพั ะฟะพะปัะทะพะฒะฐัะตะปั, ะธะผั ะธะปะธ ะฐะดัะตั ัะปะตะบััะพะฝะฝะพะน ะฟะพััั. ะะฐะถะดัะน ัะตัััั ัะดะพััะพะฒะตัะตะฝะธะน ะธะผะตะตั ัะฝะธะบะฐะปัะฝะพะต ะธะผั ะธ ะฟัะพะธะทะฒะพะปัะฝัั ััะฒะตัะถะดะตะฝะธะน ะผะพะถะฝะพ ะฝะฐะทะฝะฐัะธัั ัะธะฟั, ะบะพัะพััะต ะฑัะดัั ะฒะบะปััะตะฝั ะฒ ะผะฐัะบะตั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั. ะ ัะปะตะดัััะตะผ ะบะพะดะต ะฟะพะบะฐะทะฐะฝะพ ะฒ ะฟัะธะผะตัะต `GetResources` ะผะตัะพะด, ะบะพัะพััะน ัะพะดะตัะถะธั ััั ะบะพะปะปะตะบัะธั ะฝะฐ eShopOnContainers ะพะฑัะฐัะตะฝะธะต ะบ ะฟัะธะปะพะถะตะฝะธั:

```csharp
publicยstaticยIEnumerable<IdentityResource>ยGetResources()  
{  
ยยยยreturnยnewยList<IdentityResource>  
ยยยย{  
ยยยยยยยยnewยIdentityResources.OpenId(),  
ยยยยยยยยnewยIdentityResources.Profile()  
ยยยย};  
}
```

ะกะฟะตัะธัะธะบะฐัะธะธ OpenID Connect ะพะฟะธััะฒะฐะตั ะฝะตะบะพัะพััะต [ัะตััััั ััะฐะฝะดะฐััะฝัะต ัะดะพััะพะฒะตัะตะฝะธั](https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims). ะะธะฝะธะผะฐะปัะฝัะผ ััะตะฑะพะฒะฐะฝะธะตะผ ัะฒะปัะตััั ัะพ, ััะพ ะฟะพะดะดะตัะถะบะฐ ะฟัะตะดะพััะฐะฒะปัะตััั ะดะปั ะฒัะดะฐัะธ ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน. ะญัะพ ะดะพััะธะณะฐะตััั ะฟััะตะผ ะฟัะตะดะพััะฐะฒะปะตะฝะธั `IdentityResources.OpenId` ัะตัััั ะธะดะตะฝัะธัะธะบะฐัะพัะพะฒ.

> [!NOTE]
> `IdentityResources` ะะปะฐัั ะฟะพะดะดะตัะถะธะฒะฐะตั ะฒัะต ะพะฑะปะฐััะธ, ะพะฟัะตะดะตะปะตะฝะฝัะต ะฒ ัะฟะตัะธัะธะบะฐัะธะธ OpenID Connect (openid, ัะปะตะบััะพะฝะฝะพะน ะฟะพััั, ะฟัะพัะธะปั, ัะตะปะตัะพะฝะฐ ะธ ะฐะดัะตั).

IdentityServer ัะฐะบะถะต ะฟะพะดะดะตัะถะธะฒะฐะตั ะพะฟัะตะดะตะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ัะดะพััะพะฒะตัะตะฝะธะน ัะตััััะพะฒ. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ะพะฟัะตะดะตะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ัะดะพััะพะฒะตัะตะฝะธะน ัะตััััะพะฒ](http://docs.identityserver.io/en/latest/topics/resources.html#defining-custom-identity-resources) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ `IdentityResource` ะฒะฒะตะดะธัะต, ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะตัััั ะธะดะตะฝัะธัะธะบะฐัะพัะพะฒ](https://identityserver4.readthedocs.io/en/latest/reference/identity_resource.html) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer 4.

#### <a name="configuring-clients"></a>ะะฐัััะพะนะบะฐ ะบะปะธะตะฝัะพะฒ

ะะปะธะตะฝัั ัะฒะปััััั ะฟัะธะปะพะถะตะฝะธัะผะธ, ะบะพัะพััะต ะผะพะถะตั ะทะฐะฟัะฐัะธะฒะฐัั ะผะฐัะบะตัั ะธะท IdentityServer. ะะฐะบ ะฟัะฐะฒะธะปะพ ัะปะตะดัััะธะต ะฟะฐัะฐะผะตััั ะดะพะปะถะฝั ะฑััั ะพะฟัะตะดะตะปะตะฝั ะดะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ ะบะฐะบ ะผะธะฝะธะผัะผ:

-   ะะดะตะฝัะธัะธะบะฐัะพั ัะฝะธะบะฐะปัะฝะพะณะพ ะบะปะธะตะฝัะฐ.
-   ะะฐะทัะตัะตะฝะฝัะต ะฒะทะฐะธะผะพะดะตะนััะฒะธั ัะพ ัะปัะถะฑะพะน ะผะฐัะบะตัะพะฒ (ะธะทะฒะตััะฝัะน ะบะฐะบ ัะธะฟ ะฟัะตะดะพััะฐะฒะปะตะฝะธั).
-   ะะฐัะฟะพะปะพะถะตะฝะธะต, ะณะดะต ะพัะฟัะฐะฒะปััััั ัะพะบะตะฝั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะธ ะดะพัััะฟะฐ (ะธะทะฒะตััะฝัะน ะบะฐะบ URI ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั).
-   ะกะฟะธัะพะบ ัะตััััะพะฒ, ะบะพัะพััะต ะบะปะธะตะฝั ะผะพะถะตั ะฟะพะปััะธัั ะดะพัััะฟ ะบ (ะธะทะฒะตััะฝัะน ะบะฐะบ ะพะฑะปะฐััะธ).

ะัะธ ะฝะฐัััะพะนะบะต ะบะปะธะตะฝัะพะฒ, `AddInMemoryClients` ะพะถะธะดะฐะตั, ััะพ ะผะตัะพะด `IEnumerable<Client>` ะบะพะปะปะตะบัะธะธ. ะ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ ะฟะพะบะฐะทะฐะฝะฐ ะบะพะฝัะธะณััะฐัะธั ะดะปั ะผะพะฑะธะปัะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั eShopOnContainers ะฒ `GetClients` ะผะตัะพะด, ะบะพัะพััะน ัะพะดะตัะถะธั ััั ะบะพะปะปะตะบัะธั ะฝะฐ eShopOnContainers ะพะฑัะฐัะตะฝะธะต ะบ ะฟัะธะปะพะถะตะฝะธั:

```csharp
publicยstaticยIEnumerable<Client>ยGetClients(Dictionary<string,string>ยclientsUrl)
{
ยยยยreturnยnewยList<Client>
ยยยย{
ยยยยยยยย...
ยยยยยยยยnewยClient
ยยยยยยยย{
ยยยยยยยยยยยยClientIdย=ย"xamarin",
ยยยยยยยยยยยยClientNameย=ย"eShopยXamarinยOpenIdยClient",
ยยยยยยยยยยยยAllowedGrantTypesย=ยGrantTypes.Hybrid,
ยยยยยยยยยยยยClientSecretsย=
ยยยยยยยยยยยย{
ยยยยยยยยยยยยยยยยnewยSecret("secret".Sha256())
ยยยยยยยยยยยย},
ยยยยยยยยยยยยRedirectUrisย=ย{ยclientsUrl["Xamarin"]ย},
ยยยยยยยยยยยยRequireConsentย=ยfalse,
ยยยยยยยยยยยยRequirePkceย=ยtrue,
ยยยยยยยยยยยยPostLogoutRedirectUrisย=ย{ย$"{clientsUrl["Xamarin"]}/Account/Redirecting"ย},
ยยยยยยยยยยยยAllowedCorsOriginsย=ย{ย"http://eshopxamarin"ย},
ยยยยยยยยยยยยAllowedScopesย=ยnewยList<string>
ยยยยยยยยยยยย{
ยยยยยยยยยยยยยยยยIdentityServerConstants.StandardScopes.OpenId,
ยยยยยยยยยยยยยยยยIdentityServerConstants.StandardScopes.Profile,
ยยยยยยยยยยยยยยยยIdentityServerConstants.StandardScopes.OfflineAccess,
ยยยยยยยยยยยยยยยย"orders",
ยยยยยยยยยยยยยยยย"basket"
ยยยยยยยยยยยย},
ยยยยยยยยยยยยAllowOfflineAccessย=ยtrue,
ยยยยยยยยยยยยAllowAccessTokensViaBrowserย=ยtrue
ยยยยยยยย},
ยยยยยยยย...
ยยยย};
}
```

ะญัะฐ ะบะพะฝัะธะณััะฐัะธั ัะบะฐะทัะฒะฐะตั ะดะฐะฝะฝัะต ะดะปั ัะปะตะดัััะธั ัะฒะพะนััะฒ:

-   `ClientId`: ะฃะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะดะปั ะบะปะธะตะฝัะฐ.
-   `ClientName`: ะัะพะฑัะฐะถะฐะตะผะพะต ะธะผั ะบะปะธะตะฝัะฐ, ะบะพัะพััะน ะธัะฟะพะปัะทัะตััั ะดะปั ะฒะตะดะตะฝะธั ะถััะฝะฐะปะฐ ะธ ะฝะฐ ัะบัะฐะฝะต ัะพะณะปะฐัะธั.
-   `AllowedGrantTypes`: ะฃะบะฐะทัะฒะฐะตั, ะบะฐะบ ะบะปะธะตะฝั ัะพัะตั ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ั identityserver ะดะพะปะถะฝะพ. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ะะฐัััะพะนะบะฐ ะฟะพัะพะบ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ](#configuring_the_authentication_flow).
-   `ClientSecrets`: ะะฐะดะฐะตั ััะตัะฝัะต ะดะฐะฝะฝัะต ัะตะบัะตัะฐ ะบะปะธะตะฝัะฐ, ะบะพัะพััะต ะธัะฟะพะปัะทััััั ะฟัะธ ะทะฐะฟัะพัะต ะผะฐัะบะตัะพะฒ ะพั ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะผะฐัะบะตัะพะฒ.
-   `RedirectUris`: ะฃะบะฐะทัะฒะฐะตั ะดะพะฟัััะธะผัะน URI, ะบ ะบะพัะพััะผ ะดะปั ะฒะพะทะฒัะฐัะฐ ะผะฐัะบะตัะพะฒ ะธะปะธ ะบะพะดั ะฐะฒัะพัะธะทะฐัะธะธ.
-   `RequireConsent`: ะฃะบะฐะทัะฒะฐะตั, ััะตะฑัะตััั ะปะธ ัะบัะฐะฝ ัะพะณะปะฐัะธั.
-   `RequirePkce`: ะัะธะทะฝะฐะบ ัะพะณะพ, ะบะปะธะตะฝัั, ะธัะฟะพะปัะทัััะธะต ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะพัะฟัะฐะฒะบะธ ะบะปััะฐ ะฟัะพะฒะตัะบะธ.
-   `PostLogoutRedirectUris`: ะฃะบะฐะทัะฒะฐะตั URI, ััะพะฑั ะฒัะฟะพะปะฝะธัั ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฟะพัะปะต ะฒััะพะดะฐ.
-   `AllowedCorsOrigins`: ะฃะบะฐะทัะฒะฐะตั ะธััะพัะฝะธะบ, ะบะปะธะตะฝัะฐ, ัะฐะบะธะผ ะพะฑัะฐะทะพะผ, ัะตัะฒะตั ะผะพะถะตั ัะฐะทัะตัะธัั ะฒัะทะพะฒั ะฝะตะทะฐะฒะธัะธะผะพ ะพั ะธััะพัะฝะธะบะฐ ะพั ะฝะฐัะฐะปะฐ ะบะพะพัะดะธะฝะฐั.
-   `AllowedScopes`: ะฃะบะฐะทัะฒะฐะตั ัะตััััั, ะบ ะบะพัะพััะผ ะบะปะธะตะฝั ะธะผะตะตั ะดะพัััะฟ. ะะพ ัะผะพะปัะฐะฝะธั ะบะปะธะตะฝั ะฝะต ะธะผะตะตั ะดะพัััะฟะฐ ะบ ะปัะฑัะผ ัะตััััะฐะผ.
-   `AllowOfflineAccess`: ะฃะบะฐะทัะฒะฐะตั, ะผะพะถะตั ะปะธ ะบะปะธะตะฝั ะทะฐะฟัะฐัะธะฒะฐัั ะผะฐัะบะตัั ะพะฑะฝะพะฒะปะตะฝะธั.

<a name="configuring_the_authentication_flow" />

#### <a name="configuring-the-authentication-flow"></a>ะะฐัััะพะนะบะฐ ะฟะพัะพะบะฐ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ

ะะพัะพะบ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะผะตะถะดั ะบะปะธะตะฝัะพะผ ะธ IdentityServer ะผะพะถะฝะพ ะฝะฐัััะพะธัั, ัะบะฐะทะฐะฒ ัะธะฟะพะฒ ะฟัะตะดะพััะฐะฒะปะตะฝะธั ัะฐะทัะตัะตะฝะธั ะฒ `Client.AllowedGrantTypes` ัะฒะพะนััะฒะพ. ะกะฟะตัะธัะธะบะฐัะธะธ OpenID Connect ะธ OAuth 2.0 ะพะฟัะตะดะตะปะธัั ะบะพะปะธัะตััะฒะพ ะฟะพัะพะบะพะฒ ะฐััะตะฝัะธัะธะบะฐัะธะธ, ะฒะบะปััะฐั:

-   ะะตัะฒะฝัะต. ะญัะพั ะฟะพัะพะบ ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ ะดะปั ะฟัะธะปะพะถะตะฝะธะน ะฝะฐ ะพัะฝะพะฒะต ะฑัะฐัะทะตัะฐ ะธ ะดะพะปะถะตะฝ ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั ัะพะปัะบะพ ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะธะปะธ ะทะฐะฟัะพัั ะผะฐัะบะตัะพะฒ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะดะพัััะฟะฐ. ะัะต ะผะฐัะบะตัั ะฟัะธ ะฟะตัะตะดะฐัะต ัะตัะตะท ะฑัะฐัะทะตั ะธ ะฟะพััะพะผั ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะฒะพะทะผะพะถะฝะพััะธ, ะฝะฐะฟัะธะผะตั ะผะฐัะบะตัั ะพะฑะฝะพะฒะปะตะฝะธั ะฝะต ัะฐะทัะตัะตะฝั.
-   ะะพะด ะฐะฒัะพัะธะทะฐัะธะธ. ะญัะพั ะฟะพัะพะบ ะพะฑะตัะฟะตัะธะฒะฐะตั ะฒะพะทะผะพะถะฝะพััั ะฟะพะปััะฐัั ัะพะบะตะฝั ะพั ัะตัะตะท ะพะฑัะฐัะฝัะน ะบะฐะฝะฐะป, ะฒ ะพัะปะธัะธะต ะพั ะฒะฝะตัะฝะตะณะพ ะบะฐะฝะฐะปะฐ ะฑัะฐัะทะตัะฐ, ัะพ ะถะต ะฒัะตะผั ัะฐะบะถะต ะฟะพะดะดะตัะถะธะฒะฐะตั ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ะบะปะธะตะฝัะฐ.
-   ะะธะฑัะธะดะฝัะน. ะญัะพั ะฟะพัะพะบ ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ัะพัะตัะฐะฝะธะต ะฝะตัะฒะฝัะน ะธ ัะธะฟั ะฟัะตะดะพััะฐะฒะปะตะฝะธั ะบะพะดะฐ ะฐะฒัะพัะธะทะฐัะธะธ. ะะฐัะบะตั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะฟะตัะตะดะฐะตััั ะฟะพ ะบะฐะฝะฐะปั ะฑัะฐัะทะตัะฐ ะธ ัะพะดะตัะถะธั ะพัะฒะตั ัะพ ะทะฝะฐะบะพะผ ะฟัะพัะพะบะพะปะฐ, ะฐ ัะฐะบะถะต ะดััะณะธะต ะฐััะตัะฐะบัั, ัะฐะบะธะต ะบะฐะบ ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ. ะะพัะปะต ััะฟะตัะฝะพะน ะฟัะพะฒะตัะบะธ ะพัะฒะตัะฐ ะพะฑัะฐัะฝะพะณะพ ะบะฐะฝะฐะปะฐ ะดะพะปะถะตะฝ ะธัะฟะพะปัะทะพะฒะฐัััั ะดะปั ะฟะพะปััะตะฝะธั ะดะพัััะฟะฐ ะธ ัะพะบะตะฝะฐ ะพะฑะฝะพะฒะปะตะฝะธั.

> [!TIP]
> ะัะฟะพะปัะทัะนัะต ะณะธะฑัะธะดะฝัะน ะฟะพัะพะบ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ. ะะพัะพะบ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะณะธะฑัะธะดะฝะพะณะพ ัะฝะธะถะฐะตั ะบะพะปะธัะตััะฒะพ ะฐัะฐะบ, ะฟัะธะผะตะฝะธะผัะต ะบ ะบะฐะฝะฐะปั ะฑัะฐัะทะตัะฐ ะธ ัะฒะปัะตััั ัะตะบะพะผะตะฝะดัะตะผัะน ัะฐะฑะพัะธะน ะฟัะพัะตัั ะดะปั ัะพะฑััะฒะตะฝะฝัั ะฟัะธะปะพะถะตะฝะธะน, ะบะพัะพััะต ะฝัะถะฝะพ ะฟะพะปััะธัั ะผะฐัะบะตัั ะดะพัััะฟะฐ (ะธ ะฒะพะทะผะพะถะฝะพ ะดะปั ะผะฐัะบะตัะพะฒ ะพะฑะฝะพะฒะปะตะฝะธั).

ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะพัะพะบะฐั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะธะฟั ะฟัะตะดะพััะฐะฒะปะตะฝะธั](https://identityserver4.readthedocs.io/en/latest/topics/grant_types.html) ะฒ ะดะพะบัะผะตะฝัะฐัะธะธ ะฟะพ IdentityServer 4.

### <a name="performing-authentication"></a>ะัะฟะพะปะฝะตะฝะธะต ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ

ะะปั IdentityServer ะดะปั ะฒัะดะฐัะธ ะผะฐัะบะตัะพะฒ ะพั ะธะผะตะฝะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะปัะทะพะฒะฐัะตะปั ะดะพะปะถะตะฝ ะฒะพะนัะธ ะฒ ะบ IdentityServer. ะขะตะผ ะฝะต ะผะตะฝะตะต ัะตัะฒะตั ะฝะต ะฟัะตะดะพััะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะน ะธะฝัะตััะตะนั ะธะปะธ ะฑะฐะทั ะดะฐะฝะฝัั ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะฒ ะพะฑัะฐะทัะต ะฟัะธะปะพะถะตะฝะธั eShopOnContainers, ะดะปั ััะพะน ัะตะปะธ ะธัะฟะพะปัะทัะตััั ัะดะพััะพะฒะตัะตะฝะธะต ASP.NET Core.

ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต eShopOnContainers ะธัะฟะพะปัะทัะตั ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ั identityserver ะดะพะปะถะฝะพ ะณะธะฑัะธะดะฝัะน ะฟะพัะพะบ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฝะฐ ัะธััะฝะบะต 9-2.

![](authentication-and-authorization-images/sign-in.png "ะะฑัะตะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะพ ะฟัะพัะตััะต ะฒัะพะดะฐ ะฒ ัะธััะตะผั")

**ะะธั. 9-2.** ะะฑัะตะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะพ ะฟัะพัะตััะต ะฒัะพะดะฐ ะฒ ัะธััะตะผั

ะกะดะตะปะฐะฝ ะทะฐะฟัะพั ะฒัะพะดะฐ ะฒ ัะธััะตะผั ะฝะฐ `<base endpoint>:5105/connect/authorize`. ะะพัะปะต ััะฟะตัะฝะพะน ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะตัะฒะตั ะฒะพะทะฒัะฐัะฐะตั ะพัะฒะตั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ัะพะดะตัะถะฐัะธะน ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะธ ัะพะบะตะฝ ัะดะพััะพะฒะตัะตะฝะธั. ะะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะทะฐัะตะผ ะพัะฟัะฐะฒะปัะตััั `<base endpoint>:5105/connect/token`, ะบะพัะพััะน ะพัะฒะตัะฐะตั ั ะดะพัััะฟะพะผ, ัะดะพััะพะฒะตัะตะฝะธั ะธ ะผะฐัะบะตัั ะพะฑะฝะพะฒะปะตะฝะธั.

EShopOnContainers ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะทะฝะฐะบะธ ะณะพัะพะฒะพะน IdentityServer, ะพัะฟัะฐะฒะธะฒ ะทะฐะฟัะพั ะฝะฐ `<base endpoint>:5105/connect/endsession`, ั ะดะพะฟะพะปะฝะธัะตะปัะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ. ะะพัะปะต ะฒััะพะดะฐ, ัะตัะฒะตั ะพัะฒะตัะฐะตั, ะพัะฟัะฐะฒะปัั URI ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั ะฟะพัะปะต ะฒััะพะดะฐ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต. ะญัะพั ะฟัะพัะตัั ะฟะพะบะฐะทะฐะฝ ะฝะฐ ัะธั. 9-3.

![](authentication-and-authorization-images/sign-out.png "ะะฑัะตะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะพ ะฟัะพัะตััะต ะฒััะพะดะฐ")

**ะะธั. 9-3.** ะะฑัะตะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะพ ะฟัะพัะตััะต ะฒััะพะดะฐ

ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers, ะพัััะตััะฒะปัะตััั ะฒะทะฐะธะผะพะดะตะนััะฒะธะต ั identityserver ะดะพะปะถะฝะพ `IdentityService` ะบะปะฐััะฐ, ะบะพัะพััะน ัะตะฐะปะธะทัะตั `IIdentityService` ะธะฝัะตััะตะนั. ะญัะพั ะธะฝัะตััะตะนั ะพะฟัะตะดะตะปัะตั, ััะพ ัะตะฐะปะธะทัััะธะน ะบะปะฐัั ะดะพะปะถะตะฝ ะฟัะตะดะพััะฐะฒะธัั `CreateAuthorizationRequest`, `CreateLogoutRequest`, ะธ `GetTokenAsync` ะผะตัะพะดั.

#### <a name="signing-in"></a>ะัะพะด ะฒ ัะธััะตะผั

ะะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะบะฐัะฐะตััั **ะฒัะพะดะฐ** ะบะฝะพะฟะบั `LoginView`, `SignInCommand` ะฒ `LoginViewModel` ะฒัะฟะพะปะฝัะตััั ะบะปะฐัั, ะบะพัะพััะน ะฒ ัะฒะพั ะพัะตัะตะดั ะฒัะฟะพะปะฝัะตั `SignInAsync` ะผะตัะพะด. ะญัะพั ะผะตัะพะด ะฟะพะบะฐะทะฐะฝ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
privateยasyncยTaskยSignInAsync()  
{  
ยยยย...  
ยยยยLoginUrlย=ย_identityService.CreateAuthorizationRequest();  
ยยยยIsLoginย=ยtrue;  
ยยยย...  
}
```

ะญัะพั ะผะตัะพะด ะฒัะทัะฒะฐะตั `CreateAuthorizationRequest` ะผะตัะพะด ะฒ `IdentityService` ะบะปะฐัั, ะบะพัะพััะน ะฟะพะบะฐะทะฐะฝ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
publicยstringยCreateAuthorizationRequest()
{
ยยยย//ยCreateยURIยtoยauthorizationยendpoint
ยยยยvarยauthorizeRequestย=ยnewยAuthorizeRequest(GlobalSetting.Instance.IdentityEndpoint);

ยยยย//ยDictionaryยwithยvaluesยforยtheยauthorizeยrequest
ยยยยvarยdicย=ยnewยDictionary<string,ยstring>();
ยยยยdic.Add("client_id",ยGlobalSetting.Instance.ClientId);
ยยยยdic.Add("client_secret",ยGlobalSetting.Instance.ClientSecret);ย
ยยยยdic.Add("response_type",ย"codeยid_token");
ยยยยdic.Add("scope",ย"openidยprofileยbasketยordersยlocationsยmarketingยoffline_access");
ยยยยdic.Add("redirect_uri",ยGlobalSetting.Instance.IdentityCallback);
ยยยยdic.Add("nonce",ยGuid.NewGuid().ToString("N"));
ยยยยdic.Add("code_challenge",ยCreateCodeChallenge());
ยยยยdic.Add("code_challenge_method",ย"S256");

ยยยย//ยAddยCSRFยtokenยtoยprotectยagainstยcross-siteยrequestยforgeryยattacks.
ยยยยvarยcurrentCSRFTokenย=ยGuid.NewGuid().ToString("N");
ยยยยdic.Add("state",ยcurrentCSRFToken);

ยยยยvarยauthorizeUriย=ยauthorizeRequest.Create(dic);ย
ยยยยreturnยauthorizeUri;
}

```

ะญัะพั ะผะตัะพะด ัะพะทะดะฐะตั URI ะดะปั ัะปะตะผะตะฝัะฐ IdentityServer [ะบะพะฝะตัะฝะฐั ัะพัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ](https://identityserver4.readthedocs.io/en/latest/endpoints/authorize.html), ั ะฝะตะพะฑัะพะดะธะผัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ. ะะพะฝะตัะฝะฐั ัะพัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ ะฝะฐัะพะดะธััั ะฒ `/connect/authorize` ะฝะฐ ะฟะพััะต 5105 ะฑะฐะทะพะฒัะน ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะฒ ะฒะธะดะต ะฟะฐัะฐะผะตััะฐ ะฟะพะปัะทะพะฒะฐัะตะปั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะฟะฐัะฐะผะตััะฐั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> ะฃัะทะฒะธะผะพััั ะฒ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ัะผะตะฝััะฐะตััั ะฟััะตะผ ัะตะฐะปะธะทะฐัะธะธ ะบะปััะฐ ะฟัะพะฒะตัะบะธ ะดะปั ะพะฑะผะตะฝะฐ ะบะพะดะพะผ (PKCE) ัะฐััะธัะตะฝะธั OAuth. PKCE ะทะฐัะธัะฐะตั ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะธัะฟะพะปัะทัะตััั, ะตัะปะธ ะพะฝะพ ะฟะตัะตัะฒะฐััะฒะฐะตััั. ะญัะพ ะดะพััะธะณะฐะตััั ะฟััะตะผ ัะพะทะดะฐะฝะธั ัะตะบัะตัะฐ verifier, ััั ะบะพัะพัะพะณะพ ะฟะตัะตะดะฐะตััั ะฒ ะทะฐะฟัะพัะต ะฝะฐ ะฐะฒัะพัะธะทะฐัะธั, ะบะปะธะตะฝั ะธ ะฟัะตะดััะฐะฒะปะตะฝะฝะพะต ะฝะตัะตัะธัะพะฒะฐะฝะฝะพะน ะฟัะธ ะฐะบัะธะฒะฐัะธะธ ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ PKCE, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะบะปัั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะดะปั ะบะพะดะฐ Exchange ั ะพะฑัะตะดะพัััะฟะฝัั ะบะปะธะตะฝัะพะฒ OAuth](https://tools.ietf.org/html/rfc7636) ะฒะตะฑ-ัะฐะนัะต Internet Engineering Task Force.

ะะพะปััะตะฝะฝัะน URI ััะฐะฝะธััั ะฒ `LoginUrl` ัะฒะพะนััะฒะพ `LoginViewModel` ะบะปะฐััะฐ. ะะพะณะดะฐ `IsLogin` ัะฒะพะนััะฒะพ ััะฐะฝะพะฒะธััั `true`, [ `WebView` ](xref:Xamarin.Forms.WebView) ะฒ `LoginView` ััะฐะฝะพะฒะธััั ะฒะธะดะธะผัะผ. `WebView` ะัััะตััะฒะปัะตั ะฟัะธะฒัะทะบั ะดะฐะฝะฝัั ะตะณะพ [ `Source` ](xref:Xamarin.Forms.WebView.Source) ัะฒะพะนััะฒะฐ `LoginUrl` ัะฒะพะนััะฒะพ `LoginViewModel` ะบะปะฐััะฐ ะธ ะฟะพััะพะผั IdentityServer ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ะฒัะพะดะฐ ะฒ ัะธััะตะผั ะฟัะธ `LoginUrl` ัะฒะพะนััะฒะพ ะธะผะตะตั ะทะฝะฐัะตะฝะธะต ะ IdentityServer ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะฐะฒัะพัะธะทะฐัะธะธ. ะะพะณะดะฐ ัะตัะฒะตั ะฟะพะปััะฐะตั ััะพั ะทะฐะฟัะพั, ะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฟัะพัะตะป ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ, `WebView` ะฑัะดะตัะต ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝั ะฝะฐ ัััะฐะฝะธัั ะฝะฐัััะพะตะฝะฝะพะณะพ ะฒัะพะดะฐ, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฝะฐ ัะธััะฝะบะต 9-4.

![](authentication-and-authorization-images/login.png "ะกััะฐะฝะธัะฐ ะฒัะพะดะฐ, ะพัะพะฑัะฐะถะฐะตะผะพะณะพ ัะปะตะผะตะฝัะพะผ ะฒะตะฑ-ะฟัะตะดััะฐะฒะปะตะฝะธั")

**ะะธั. 9-4.** ะกััะฐะฝะธัะฐ ะฒัะพะดะฐ, ะพัะพะฑัะฐะถะฐะตะผะพะณะพ ัะปะตะผะตะฝัะพะผ ะฒะตะฑ-ะฟัะตะดััะฐะฒะปะตะฝะธั

ะะพัะปะต ะทะฐะฒะตััะตะฝะธั ะฒัะพะดะฐ [ `WebView` ](xref:Xamarin.Forms.WebView) ะฑัะดัั ะฟะตัะตะฝะฐะฟัะฐะฒะปััััั ะฒ ะฒะพะทะฒัะฐัะฐะตะผะพะต URI. ะญัะพ `WebView` ะฝะฐะฒะธะณะฐัะธะธ ะฟัะธะฒะตะดะตั ะบ `NavigateAsync` ะผะตัะพะด ะฒ `LoginViewModel` ะบะปะฐััะฐ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
privateยasyncยTaskยNavigateAsync(stringยurl)  
{  
ยยยย...  
ยยยยvarยauthResponseย=ยnewยAuthorizeResponse(url);  
ยยยยifย(!string.IsNullOrWhiteSpace(authResponse.Code))  
ยยยย{  
ยยยยยยยยvarยuserTokenย=ยawaitย_identityService.GetTokenAsync(authResponse.Code);  
ยยยยยยยยstringยaccessTokenย=ยuserToken.AccessToken;  

ยยยยยยยยifย(!string.IsNullOrWhiteSpace(accessToken))  
ยยยยยยยย{  
ยยยยยยยยยยยยSettings.AuthAccessTokenย=ยaccessToken;  
ยยยยยยยยยยยยSettings.AuthIdTokenย=ยauthResponse.IdentityToken;  

ยยยยยยยยยยยยawaitยNavigationService.NavigateToAsync<MainViewModel>();  
ยยยยยยยยยยยยawaitยNavigationService.RemoveLastFromBackStackAsync();  
ยยยยยยยย}  
ยยยย}  
ยยยย...  
}
```

ะญัะพั ะผะตัะพะด ะฒัะฟะพะปะฝัะตั ัะธะฝัะฐะบัะธัะตัะบะธะน ะฐะฝะฐะปะธะท, ัะพะดะตัะถะฐัะธะนัั ะฒ URI, ะฒะพะทะฒัะฐัะฐะตะผัะน ะพัะฒะตั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะธ ะฟัะธ ััะปะพะฒะธะธ, ััะพ ะฟัะธัััััะฒัะตั ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ, ะพะฝะพ ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ะบ IdentityServer [ะบะพะฝะตัะฝะฐั ัะพัะบะฐ ะผะฐัะบะตัะฐ](https://identityserver4.readthedocs.io/en/latest/endpoints/token.html), ะฟะตัะตะดะฐะฒะฐั ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ, ะกัะตะดััะฒะพ ะฟัะพะฒะตัะบะธ PKCE ะดะปั ัะตะบัะตัะฐ ะธ ะดััะณะธะต ะฝะตะพะฑัะพะดะธะผัะต ะฟะฐัะฐะผะตััั. ะะพะฝะตัะฝะฐั ัะพัะบะฐ ะผะฐัะบะตัะฐ ะฝะฐัะพะดะธััั ะฒ `/connect/token` ะฝะฐ ะฟะพััะต 5105 ะฑะฐะทะพะฒัะน ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะฒ ะฒะธะดะต ะฟะฐัะฐะผะตััะฐ ะฟะพะปัะทะพะฒะฐัะตะปั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะฟะฐัะฐะผะตััะฐั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

>๐ก **ะกะพะฒะตั**: ะัะพะฒะตัะบะฐ ะฒะพะทะฒัะฐัะฐะตะผะพะณะพ ะทะฝะฐัะตะฝะธั ะธะดะตะฝัะธัะธะบะฐัะพัั URI. ะะตัะผะพััั ะฝะฐ ัะพ, ััะพ ะฒ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ะฝะต ะฟัะพะฒะตััะตั ะฒะพะทะฒัะฐัะฐะตะผะพะต URI, ัะตะบะพะผะตะฝะดัะตััั ะฟัะพะฒะตัะธัั, ััะพ ะฒะพะทะฒัะฐัะฐะตะผะพะต URI ัััะปะฐะตััั ะฝะฐ ะธะทะฒะตััะฝะพะผ ัะฐัะฟะพะปะพะถะตะฝะธะธ, ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะฐัะฐะบ ะพัะบัััะพะณะพ ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั.

ะัะปะธ ะบะพะฝะตัะฝะฐั ัะพัะบะฐ ะผะฐัะบะตัะฐ ะฟะพะปััะฐะตั ะบะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะธ ะฟัะพะฒะตัะบะธ ัะตะบัะตัะฝัะน PKCE, ะพะฝ ะพัะฒะตัะฐะตั ะผะฐัะบะตั ะดะพัััะฟะฐ, ะผะฐัะบะตั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะธ ะผะฐัะบะตั ะพะฑะฝะพะฒะปะตะฝะธั. ะะฐัะบะตั ะดะพัััะฟะฐ (ะบะพัะพััะน ะฟัะตะดะพััะฐะฒะปัะตั ะดะพัััะฟ ะบ ัะตััััะฐะผ API) ะธ ะผะฐัะบะตั ะทะฐัะตะผ ัะพััะฐะฝััััั ะบะฐะบ ะฟะฐัะฐะผะตััั ะฟัะธะปะพะถะตะฝะธั, ะธ ะฒัะฟะพะปะฝัะตััั ะฟะตัะตัะพะด ะฟะพ ัััะฐะฝะธัะฐะผ. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะพะฑัะธะน ัััะตะบั ะฒ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ััะพ: ะฟัะธ ััะปะพะฒะธะธ, ััะพ ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ััะฟะตัะฝะพ ะฟัะพะนัะธ ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ั identityserver ะดะพะปะถะฝะพ, ะฟะตัะตัะพะดะต ะบ `MainView` ัััะฐะฝะธัะฐ, ะบะพัะพัะฐั ัะฒะปัะตััั [ `TabbedPage` ](xref:Xamarin.Forms.TabbedPage) ะพัะพะฑัะฐะถะฐััะธะน `CatalogView` ะบะฐะบ ะตะณะพ ะฒัะฑัะฐะฝะฝะพะน ะฒะบะปะฐะดะบะธ.

ะกะฒะตะดะตะฝะธั ะพ ะฝะฐะฒะธะณะฐัะธะธ ะฟะพ ัััะฐะฝะธัะฐะผ, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฝะฐะฒะธะณะฐัะธะธ](~/xamarin-forms/enterprise-application-patterns/navigation.md). ะกะฒะตะดะตะฝะธั ะพ ัะพะผ, ะบะฐะบ [ `WebView` ](xref:Xamarin.Forms.WebView) ะฝะฐะฒะธะณะฐัะธะธ ะฒัะทัะฒะฐะตั ะผะตัะพะด ะผะพะดะตะปะธ ะฟัะตะดััะฐะฒะปะตะฝะธั ะดะปั ะฒัะฟะพะปะฝะตะฝะธั, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฒัะทะพะฒะฐ ะฝะฐะฒะธะณะฐัะธะธ ั ะฟะพะผะพััั ะฟะพะฒะตะดะตะฝะธะน](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). ะกะฒะตะดะตะฝะธั ะพ ะฟะฐัะฐะผะตััะฐั ะฟัะธะปะพะถะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers ัะฐะบะถะต ะฟะพะทะฒะพะปัะตั ะผะฐะบะตัะพะฒ ะฒัะพะด, ะตัะปะธ ะฟัะธะปะพะถะตะฝะธะต ะฝะฐัััะพะตะฝะพ ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะผะฐะบะตัั ัะปัะถะฑ ะฒ `SettingsView`. ะ ััะพะผ ัะตะถะธะผะต ะฟัะธะปะพะถะตะฝะธั ะฝะต ะฒะทะฐะธะผะพะดะตะนััะฒััั ั IdentityServer, ะฒะผะตััะพ ััะพะณะพ, ะฟะพะทะฒะพะปัั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะพะด ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ััะตัะฝัั ะดะฐะฝะฝัั.

#### <a name="signing-out"></a>ะะพะดะฟะธััะฒะฐะฝะธะต ัะฐะทะฒะตัััะฒะฐะฝะธั

ะะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะบะฐัะฐะตััั **ะััะพะด** ะบะฝะพะฟะบั `ProfileView`, `LogoutCommand` ะฒ `ProfileViewModel` ะฒัะฟะพะปะฝัะตััั ะบะปะฐัั, ะบะพัะพััะน ะฒ ัะฒะพั ะพัะตัะตะดั ะฒัะฟะพะปะฝัะตั `LogoutAsync` ะผะตัะพะด. ะญัะพั ะผะตัะพะด ะฒัะฟะพะปะฝัะตั ะฝะฐะฒะธะณะฐัะธั ะฟะพ ัััะฐะฝะธัะฐะผ ะดะปั `LoginView` ัััะฐะฝะธัั, ะฟะตัะตะดะฐะฒ `LogoutParameter` ัะบะทะตะผะฟะปัั ะทะฝะฐัะตะฝะธะต `true` ะบะฐะบ ะฟะฐัะฐะผะตัั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะตัะตะดะฐัะต ะฟะฐัะฐะผะตััะพะฒ ะฒะพ ะฒัะตะผั ะฝะฐะฒะธะณะฐัะธะธ ะฟะพ ัััะฐะฝะธัะฐะผ ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฟะตัะตะดะฐัะธ ะฟะฐัะฐะผะตััะพะฒ ะฒะพ ะฒัะตะผั ะฝะฐะฒะธะณะฐัะธะธ](~/xamarin-forms/enterprise-application-patterns/navigation.md#passing_parameters_during_navigation).

ะัะธ ัะพะทะดะฐะฝะธะธ ะฟัะตะดััะฐะฒะปะตะฝะธั ะธ ะพัััะตััะฒะปะตะฝ ะฟะตัะตัะพะด, `InitializeAsync` ัะฒัะทะฐะฝะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะผะพะดะตะปะธ ะฟัะตะดััะฐะฒะปะตะฝะธั ะผะตัะพะดะฐ, ะบะพัะพััะน ะทะฐัะตะผ ะฒัะฟะพะปะฝัะตั `Logout` ะผะตัะพะด `LoginViewModel` ะบะปะฐัั, ะบะพัะพััะน ะฟะพะบะฐะทะฐะฝ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
privateยvoidยLogout()  
{  
ยยยยvarยauthIdTokenย=ยSettings.AuthIdToken;  
ยยยยvarยlogoutRequestย=ย_identityService.CreateLogoutRequest(authIdToken);  

ยยยยifย(!string.IsNullOrEmpty(logoutRequest))  
ยยยย{  
ยยยยยยยย//ยLogout  
ยยยยยยยยLoginUrlย=ยlogoutRequest;  
ยยยย}  
ยยยย...  
}
```

ะญัะพั ะผะตัะพะด ะฒัะทัะฒะฐะตั `CreateLogoutRequest` ะผะตัะพะด ะฒ `IdentityService` ะบะปะฐััะฐ, ะฟะตัะตะดะฐะฒะฐั ะผะฐัะบะตั ะธะดะตะฝัะธัะธะบะฐัะธะธ, ะฟะพะปััะตะฝะฝัะต ะธะท ะฟะฐัะฐะผะตััะพะฒ ะฟัะธะปะพะถะตะฝะธั, ะบะฐะบ ะฟะฐัะฐะผะตัั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะฐัะฐะผะตััะฐั ะฟัะธะปะพะถะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md). ะะตัะพะด `CreateLogoutRequest` ะฟะพะบะฐะทะฐะฝ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
publicยstringยCreateLogoutRequest(stringยtoken)  
{  
ยยยย...  
ยยยยreturnยstring.Format("{0}?id_token_hint={1}&post_logout_redirect_uri={2}",ย  
ยยยยยยยยGlobalSetting.Instance.LogoutEndpoint,  
ยยยยยยยยtoken,  
ยยยยยยยยGlobalSetting.Instance.LogoutCallback);  
}
```

ะญัะพั ะผะตัะพะด ัะพะทะดะฐะตั URI ะดะปั ัะปะตะผะตะฝัะฐ IdentityServer [ะทะฐะฒะตััะธัั ัะตะฐะฝั ะบะพะฝะตัะฝะพะน ัะพัะบะธ](https://identityserver4.readthedocs.io/en/latest/endpoints/endsession.html#refendsession), ั ะฝะตะพะฑัะพะดะธะผัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ. ะะพะฝะตัะฝะฐั ัะพัะบะฐ ะพะบะพะฝัะฐะฝะธั ัะตะฐะฝัะฐ ะฝะฐัะพะดะธััั ะฒ `/connect/endsession` ะฝะฐ ะฟะพััะต 5105 ะฑะฐะทะพะฒัะน ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะฒ ะฒะธะดะต ะฟะฐัะฐะผะตััะฐ ะฟะพะปัะทะพะฒะฐัะตะปั. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะฟะฐัะฐะผะตััะฐั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

ะะพะปััะตะฝะฝัะน URI ััะฐะฝะธััั ะฒ `LoginUrl` ัะฒะพะนััะฒะพ `LoginViewModel` ะบะปะฐััะฐ. ะฅะพัั `IsLogin` ัะฒะพะนััะฒะพ `true`, [ `WebView` ](xref:Xamarin.Forms.WebView) ะฒ `LoginView` ัะฒะปัะตััั ะฒะธะดะธะผัะผ. `WebView` ะัััะตััะฒะปัะตั ะฟัะธะฒัะทะบั ะดะฐะฝะฝัั ะตะณะพ [ `Source` ](xref:Xamarin.Forms.WebView.Source) ัะฒะพะนััะฒะฐ `LoginUrl` ัะฒะพะนััะฒะพ `LoginViewModel` ะบะปะฐััะฐ ะธ ะฟะพััะพะผั ะทะฐะฟัะพั ะฒััะพะดะฐ ะดะปั IdentityServer ะฟัะธ `LoginUrl` ัะฒะพะนััะฒะพ ะธะผะตะตั ะทะฝะฐัะตะฝะธะต ะ IdentityServer ะบะพะฝะตัะฝะพะน ัะตะฐะฝัะฐ. ะะพะณะดะฐ ัะตัะฒะตั ะฟะพะปััะฐะตั ััะพั ะทะฐะฟัะพั, ะฟัะธ ััะปะพะฒะธะธ, ััะพ ะฟะพะปัะทะพะฒะฐัะตะปั, ะฒัะฟะพะปะฝะธะฒัะธะน ะฒัะพะด, ะฟัะพะธััะพะดะธั ะฒััะพะด. ะัะพะฒะตัะบะฐ ะฟะพะดะปะธะฝะฝะพััะธ ะพััะปะตะถะธะฒะฐะตััั ั ัะฐะนะปะพะผ cookie, ัะฟัะฐะฒะปัะตะผัั ะฟะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะฐะนะปะฐ cookie ะธะท ASP.NET Core. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะฒัะนะดั ะธะท IdentityServer ัะดะฐะปัะตั ัะฐะนะป cookie ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะพัะฟัะฐะฒะปัะตั ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั ะฟะพัะปะต ะฒััะพะดะฐ, URI ะพะฑัะฐัะฝะพ ะบะปะธะตะฝัั.

ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ [ `WebView` ](xref:Xamarin.Forms.WebView) ะฑัะดัั ะฟะตัะตะฝะฐะฟัะฐะฒะปััััั ะฒ URI ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธั ะฟะพัะปะต ะฒััะพะดะฐ. ะญัะพ `WebView` ะฝะฐะฒะธะณะฐัะธะธ ะฟัะธะฒะตะดะตั ะบ `NavigateAsync` ะผะตัะพะด ะฒ `LoginViewModel` ะบะปะฐััะฐ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
privateยasyncยTaskยNavigateAsync(stringยurl)  
{  
ยยยย...  
ยยยยSettings.AuthAccessTokenย=ยstring.Empty;  
ยยยยSettings.AuthIdTokenย=ยstring.Empty;  
ยยยยIsLoginย=ยfalse;  
ยยยยLoginUrlย=ย_identityService.CreateAuthorizationRequest();  
ยยยย...  
}
```

ะญัะพั ะผะตัะพะด ัะดะฐะปัะตั ะผะฐัะบะตั ะธะดะตะฝัะธัะธะบะฐัะธะธ ะธ ะผะฐัะบะตั ะดะพัััะฟะฐ ะธะท ะฟะฐัะฐะผะตััะพะฒ ะฟัะธะปะพะถะตะฝะธั ะธ ะทะฐะดะฐะตั `IsLogin` ัะฒะพะนััะฒะฐ `false`, ัะตะณะพ [ `WebView` ](xref:Xamarin.Forms.WebView) ะฝะฐ `LoginView` ัััะฐะฝะธัะฐ ััะฐะฝะตั ะฝะตะฒะธะดะธะผะพะน . ะะฐะบะพะฝะตั `LoginUrl` ัะฒะพะนััะฒั IdentityServer URI ะธะท [ะบะพะฝะตัะฝะฐั ัะพัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ](https://identityserver4.readthedocs.io/en/latest/endpoints/authorize.html), ั ะฝะตะพะฑัะพะดะธะผัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ, ะฒ ะฟัะพัะตััะต ะฟะพะดะณะพัะพะฒะบะธ ะฒ ัะปะตะดัััะธะน ัะฐะท, ะบะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะฝะธัะธะธััะตั ะฒัะพะด ะฒ ัะธััะตะผั.

ะกะฒะตะดะตะฝะธั ะพ ะฝะฐะฒะธะณะฐัะธะธ ะฟะพ ัััะฐะฝะธัะฐะผ, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฝะฐะฒะธะณะฐัะธะธ](~/xamarin-forms/enterprise-application-patterns/navigation.md). ะกะฒะตะดะตะฝะธั ะพ ัะพะผ, ะบะฐะบ [ `WebView` ](xref:Xamarin.Forms.WebView) ะฝะฐะฒะธะณะฐัะธะธ ะฒัะทัะฒะฐะตั ะผะตัะพะด ะผะพะดะตะปะธ ะฟัะตะดััะฐะฒะปะตะฝะธั ะดะปั ะฒัะฟะพะปะฝะตะฝะธั, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฒัะทะพะฒะฐ ะฝะฐะฒะธะณะฐัะธะธ ั ะฟะพะผะพััั ะฟะพะฒะตะดะตะฝะธะน](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). ะกะฒะตะดะตะฝะธั ะพ ะฟะฐัะฐะผะตััะฐั ะฟัะธะปะพะถะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะธะณััะฐัะธะตะน](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers ัะฐะบะถะต ะฟะพะทะฒะพะปัะตั ะผะฐะบะตัะธัะพะฒะฐะฝะธะต ะฒััะพะดะฐ ะฟัะธ ะฝะฐัััะพะนะบะต ะฟัะธะปะพะถะตะฝะธั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ SettingsView ะผะฐะบะตัั ัะปัะถะฑ. ะ ััะพะผ ัะตะถะธะผะต ะฟัะธะปะพะถะตะฝะธะต ะฝะต ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั identityserver ะดะพะปะถะฝะพ ะธ ะฒะผะตััะพ ะพัะธัะฐะตั ะฒัะต ััะฐะฝะธะผัะต ัะพะบะตะฝั ะธะท ะฟะฐัะฐะผะตััะพะฒ ะฟัะธะปะพะถะตะฝะธั.

<a name="authorization" />

## <a name="authorization"></a>ะะฒัะพัะธะทะฐัะธั

ะะพัะปะต ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฒะตะฑ-ASP.NET Core, ัะฐััะพ ััะตะฑัะตััั API-ะธะฝัะตััะตะนัั ะดะปั ัะฐะทัะตัะตะฝะธั ะดะพัััะฟะฐ, ััะพ ะฟะพะทะฒะพะปัะตั ัะปัะถะฑะต ะฟัะตะดะพััะฐะฒะธัั ะธะฝัะตััะตะนัั API ะดะพัััะฟะฝั ะฝะตะบะพัะพััะต ะฟะพะปัะทะพะฒะฐัะตะปัะผ, ะฟัะพัะตะดัะธะผ ะฟัะพะฒะตัะบั, ะฝะพ ะฝะต ะฒัะตะผ.

ะะณัะฐะฝะธัะตะฝะธะต ะดะพัััะฟะฐ ะบ ะผะฐัััััั ASP.NET Core MVC ะผะพะถะตั ะพัััะตััะฒะปััััั ะฟััะตะผ ะฟัะธะผะตะฝะตะฝะธั ะฐััะธะฑััะฐ Authorize ะบ ะบะพะฝััะพะปะปะตัั ะธะปะธ ะดะตะนััะฒะธะต, ะบะพัะพัะพะต ะพะณัะฐะฝะธัะธะฒะฐะตั ะดะพัััะฟ ะบ ะบะพะฝััะพะปะปะตัั ะธะปะธ ะดะตะนััะฒะธะต, ะฟัะพัะตะดัะธะผ ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
[Authorize]  
publicยclassยBasketControllerย:ยController  
{  
ยยยย...  
}
```

ะัะปะธ ะฝะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฟััะฐะตััั ะฟะพะปััะธัั ะดะพัััะฟ ะบ ะบะพะฝััะพะปะปะตัั ะธะปะธ ะดะตะนััะฒะธั, ะพัะผะตัะตะฝะฝัะน ะฐััะธะฑััะพะผ `Authorize` ะฐััะธะฑัั, ะฟะปะฐััะพัะผะฐ MVC ะฒะพะทะฒัะฐัะฐะตั ะบะพะด ัะพััะพัะฝะธั 401 (ะฝะตะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะน) HTTP.

> [!NOTE]
> ะะฐัะฐะผะตััั ะผะพะณัั ะฑััั ะทะฐะดะฐะฝั ะฝะฐ `Authorize` ะฐััะธะฑััะฐ ะดะปั ะพะณัะฐะฝะธัะตะฝะธั API ะดะปั ะพะฟัะตะดะตะปะตะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน. ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ัะผ. ะฒ ัะฐะทะดะตะปะต [ะฐะฒัะพัะธะทะฐัะธะธ](/aspnet/core/security/authorization/introduction/).

IdentityServer ะผะพะถะฝะพ ะธะฝัะตะณัะธัะพะฒะฐัั ะฒ ัะฐะฑะพัะธะน ะฟัะพัะตัั ะฐะฒัะพัะธะทะฐัะธะธ, ััะพะฑั ะผะฐัะบะตัั ะดะพัััะฟะฐ, ะพะฝ ะฟัะตะดะพััะฐะฒะปัะตั ะบะพะฝััะพะปั ะฐะฒัะพัะธะทะฐัะธะธ. ะญัะพั ะฟะพะดัะพะด ะฟะพะบะฐะทะฐะฝ ะฝะฐ ัะธััะฝะบะต 9-5.

![](authentication-and-authorization-images/authorization.png "ะะฒัะพัะธะทะฐัะธั ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะผะฐัะบะตัะฐ ะดะพัััะฟะฐ")

**ะะธั. 9-5.** ะะฒัะพัะธะทะฐัะธั ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะผะฐัะบะตัะฐ ะดะพัััะฟะฐ

ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะผะธะบัะพัะปัะถะฑั ะฟะพ ะธะดะตะฝัะธัะธะบะฐัะธะธ ะธ ะทะฐะฟัะฐัะธะฒะฐะตั ะผะฐัะบะตั ะดะพัััะฟะฐ ะบะฐะบ ัะฐััั ะฟัะพัะตััะฐ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ. ะะฐัะบะตั ะดะพัััะฟะฐ, ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตััั API, ะฟัะตะดะพััะฐะฒะปัะตะผัั ะผะธะบัะพัะปัะถะฑ ัะฟะพััะดะพัะตะฝะธั ะธ ะบะพัะทะธะฝั ะบะฐะบ ัะฐััั ะทะฐะฟัะพัะพะฒ ะฝะฐ ะดะพัััะฟ. ะะฐัะบะตัั ะดะพัััะฟะฐ ัะพะดะตัะถะฐั ะธะฝัะพัะผะฐัะธั ะพ ะบะปะธะตะฝัะต ะธ ะฟะพะปัะทะพะฒะฐัะตะปั. API-ะธะฝัะตััะตะนัั, ะทะฐัะตะผ ะธัะฟะพะปัะทะพะฒะฐัั ััั ะธะฝัะพัะผะฐัะธั ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ ะดะพัััะฟะฐ ะบ ะธั ะดะฐะฝะฝัะผ. ะกะฒะตะดะตะฝะธั ะพ ัะพะผ, ะบะฐะบ ะฝะฐัััะพะธัั ัะตัะฒะตั ะดะปั ะทะฐัะธัั API-ะธะฝัะตััะตะนัะพะฒ, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะะฐัััะพะนะบะฐ ัะตััััะพะฒ API](#configuring-api-resources).

### <a name="configuring-identityserver-to-perform-authorization"></a>ะะฐัััะพะนะบะฐ IdentityServer ะฒัะฟะพะปะฝะตะฝะธะต ะฐะฒัะพัะธะทะฐัะธะธ

ะัะฟะพะปะฝะตะฝะธะต ะฐะฒัะพัะธะทะฐัะธะธ ั identityserver ะดะพะปะถะฝะพ, ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั ะตะณะพ ะฐะฒัะพัะธะทะฐัะธะธ ะฟะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ะบะพะฝะฒะตะนะตั ะทะฐะฟัะพัะพะฒ HTTP ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั. ะะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ะดะพะฑะฐะฒะปัะตััั ะฒ `ConfigureAuth` ะผะตัะพะด ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั `Startup` ะบะปะฐัั, ะบะพัะพััะน ะฒัะทัะฒะฐะตััั ะธะท `Configure` ะผะตัะพะด ะธ ะดะตะผะพะฝัััะธััะตััั ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ ะธะท ััะฐะปะพะฝะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั eShopOnContainers:

```csharp
protectedยvirtualยvoidยConfigureAuth(IApplicationBuilderยapp)  
{  
ยยยยvarยidentityUrlย=ยConfiguration.GetValue<string>("IdentityUrl");  
ยยยยapp.UseIdentityServerAuthentication(newยIdentityServerAuthenticationOptions  
ยยยย{  
ยยยยยยยยAuthorityย=ยidentityUrl.ToString(),  
ยยยยยยยยScopeNameย=ย"basket",  
ยยยยยยยยRequireHttpsMetadataย=ยfalse  
ยยยย});  
}ย
```

ะญัะพั ะผะตัะพะด ะณะฐัะฐะฝัะธััะตั, ััะพ API ะผะพะถะตั ะพัััะตััะฒะปััััั ัะพะปัะบะพ ั ะดะตะนััะฒะธัะตะปัะฝัะน ะผะฐัะบะตั ะดะพัััะฟะฐ. ะะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ะฟัะพะฒะตััะตั ะฒัะพะดััะธะน ัะพะบะตะฝ, ััะพะฑั ัะฑะตะดะธัััั, ััะพ ะพะฝะพ ะพัะฟัะฐะฒะปะตะฝะพ ั ะฝะฐะดะตะถะฝัะผ ะธะทะดะฐัะตะปะตะผ ะธ ะฟัะพะฒะตััะตั, ััะพ ะผะฐัะบะตั ัะฒะปัะตััั ะดะพะฟัััะธะผัะผ ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ั API, ะบะพัะพัะฐั ะตะณะพ ะฟะพะปััะฐะตั. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะฟะตัะตะนะดั ะบ ะบะพะฝััะพะปะปะตัั ัะฟะพััะดะพัะตะฝะธะต ะธะปะธ ะบะพัะทะธะฝั ะฒะตัะฝะตั (ะฝะตัะฐะฝะบัะธะพะฝะธัะพะฒะฐะฝะฝัั) ะบะพะด ัะพััะพัะฝะธั HTTP 401, ัะบะฐะทัะฒะฐััะตะต, ััะพ ะผะฐัะบะตั ะดะพัััะฟะฐ ัะฒะปัะตััั ะพะฑัะทะฐัะตะปัะฝัะผ.

> [!NOTE]
> ะะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ัะตัะฒะตั ะฐะฒัะพัะธะทะฐัะธะธ ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั ะฒ ะบะพะฝะฒะตะนะตั ะทะฐะฟัะพัะพะฒ HTTP ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั ะฟะตัะตะด ะดะพะฑะฐะฒะปะตะฝะธะตะผ MVC ั `app.UseMvc()` ะธะปะธ `app.UseMvcWithDefaultRoute()`.

### <a name="making-access-requests-to-apis"></a>ะกะพะทะดะฐะฝะธะต ะทะฐะฟัะพัะพะฒ ะฝะฐ ะดะพัััะฟ ะบ ะธะฝัะตััะตะนัะฐะผ API

ะัะธ ัะพััะฐะฒะปะตะฝะธะธ ะทะฐะฟัะพัะพะฒ ะบ ะผะธะบัะพัะปัะถะฑ ัะฟะพััะดะพัะตะฝะธั ะธ ะบะพัะทะธะฝั, ะดะพัััะฟ ะผะฐัะบะตั, ะฟะพะปััะตะฝะฝัะน ะธะท IdentityServer ะฒะพ ะฒัะตะผั ะฟัะพัะตััะฐ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ, ะดะพะปะถะฝั ะฑััั ะฒะบะปััะตะฝั ะฒ ะทะฐะฟัะพั, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
varยauthTokenย=ยSettings.AuthAccessToken;  
Orderย=ยawaitย_ordersService.GetOrderAsync(Convert.ToInt32(order.OrderNumber),ยauthToken);
```

ะะฐัะบะตั ะดะพัััะฟะฐ ััะฐะฝะธััั ะฒ ะฒะธะดะต ะฟะฐัะฐะผะตััะฐ ะฟัะธะปะพะถะตะฝะธั ะธ ะฟะพะปััะธัั ะธะท ััะฐะฝะธะปะธัะฐ ั ะฟะปะฐััะพัะผะพะน ะธ ะฒะบะปััะตะฝั ะฒ ะฒัะทะพะฒะต `GetOrderAsync` ะผะตัะพะด ะฒ `OrderService` ะบะปะฐััะฐ.

ะะฝะฐะปะพะณะธัะฝัะผ ะพะฑัะฐะทะพะผ ะผะฐัะบะตั ะดะพัััะฟะฐ ะดะพะปะถะตะฝ ะฑััั ะฒะบะปััะตะฝ ะฟัะธ ะพัะฟัะฐะฒะบะต ะดะฐะฝะฝัั IdentityServer ะทะฐัะธัะต API, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
varยauthTokenย=ยSettings.AuthAccessToken;  
awaitย_basketService.UpdateBasketAsync(newยCustomerBasket  
{  
ยยยยBuyerIdย=ยuserInfo.UserId,ย  
ยยยยItemsย=ยBasketItems.ToList()  
},ยauthToken);
```

ะะฐัะบะตั ะดะพัััะฟะฐ ะธะทะฒะปะตะบะฐะตััั ะธะท ััะฐะฝะธะปะธัะฐ, ะทะฐะฒะธัััะตะต ะพั ะฟะปะฐััะพัะผั ะธ ะฒะบะปััะตะฝั ะฒ ะฒัะทะพะฒะต `UpdateBasketAsync` ะผะตัะพะด ะฒ `BasketService` ะบะปะฐััะฐ.

`RequestProvider` ะะปะฐัั, ะฒ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers, ะธัะฟะพะปัะทัะตั `HttpClient` ะบะปะฐััะฐ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะฟัะพัะพะฒ ะบ API-ะธะฝัะตััะตะนัะพะฒ RESTful, ะฟัะตะดะพััะฐะฒะปัะตะผัะต ะฒ ะพะฑัะฐะทัะต ะฟัะธะปะพะถะตะฝะธั eShopOnContainers. ะัะธ ะพัะฟัะฐะฒะบะต ะทะฐะฟัะพัะพะฒ ะฒ ะทะฐะบะฐะท ะธ ะบะพัะทะธะฝั API-ะธะฝัะตััะตะนัั, ะบะพัะพััะต ััะตะฑััั ะฝะฐะปะธัะธั ะฐะฒัะพัะธะทะฐัะธะธ, ะดะตะนััะฒะธัะตะปัะฝัะน ะผะฐัะบะตั ะดะพัััะฟะฐ ะดะพะปะถะตะฝ ะฑััั ะฒะบะปััะตะฝ ะฒ ะทะฐะฟัะพั. ะญัะพ ะดะพััะธะณะฐะตััั ะฟััะตะผ ะดะพะฑะฐะฒะปะตะฝะธั ะผะฐัะบะตัะฐ ะดะพัััะฟะฐ ะบ ะทะฐะณะพะปะพะฒะบะฐะผ `HttpClient` ัะบะทะตะผะฟะปััะฐ, ะบะฐะบ ะฟะพะบะฐะทะฐะฝะพ ะฒ ัะปะตะดัััะตะผ ะฟัะธะผะตัะต ะบะพะดะฐ:

```csharp
httpClient.DefaultRequestHeaders.Authorizationย=ยnewยAuthenticationHeaderValue("Bearer",ยtoken);
```

`DefaultRequestHeaders` ะกะฒะพะนััะฒะพ `HttpClient` ะบะปะฐัั ะฟัะตะดะพััะฐะฒะปัะตั ะทะฐะณะพะปะพะฒะบะธ, ะบะพัะพััะต ะพัะฟัะฐะฒะปััััั ั ะบะฐะถะดัะผ ะทะฐะฟัะพัะพะผ, ะธ ะผะฐัะบะตั ะดะพัััะฟะฐ ะดะพะฑะฐะฒะปัะตััั `Authorization` ะฟัะตัะธะบัะพะผ ัะพ ัััะพะบะพะน ะทะฐะณะพะปะพะฒะบะฐ `Bearer`. ะัะฟัะฐะฒะบะธ ะทะฐะฟัะพัะฐ ะบ API-ะธะฝัะตััะตะนัะพะฒ RESTful, ะทะฝะฐัะตะฝะธะต `Authorization` ะธะทะฒะปะตะบะฐะตััั ะธ ะฟัะพะฒะตัััั ะฝะฐ ัะพะพัะฒะตัััะฒะธะต ะพัะฟัะฐะฒะปััััั ะพั ะดะพะฒะตัะตะฝะฝะพะณะพ ะธะทะดะฐัะตะปั, ััะพ ะฟะพะทะฒะพะปัะตั ะพะฟัะตะดะตะปะธัั, ะธะผะตะตั ะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ัะฐะทัะตัะตะฝะธะต ะฝะฐ ะฒัะทะพะฒ API, ะฟะพะปััะฐะตั ะตะณะพ ะทะฐะณะพะปะพะฒะพะบ.

ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะฒะตะดะตะฝะธั ะพ ัะพะผ, ะบะฐะบ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต eShopOnContainers ะฒัะฟะพะปะฝัะตั ะฒะตะฑ-ะทะฐะฟัะพัั, ัะผ. ะฒ ัะฐะทะดะตะปะต [ะดะพัััะฟ ะบ ัะดะฐะปะตะฝะฝัะผ ะดะฐะฝะฝัะผ](~/xamarin-forms/enterprise-application-patterns/accessing-remote-data.md).

## <a name="summary"></a>ะกะฒะพะดะบะฐ

ะกััะตััะฒัะตั ะผะฝะพะถะตััะฒะพ ะฟะพะดัะพะดะพะฒ ะบ ะธะฝัะตะณัะฐัะธะธ ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ ะฒ ะฟัะธะปะพะถะตะฝะธะต Xamarin.Forms, ะบะพัะพัะพะต ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ASP.NET MVC. ะ ะผะพะฑะธะปัะฝะพะผ ะฟัะธะปะพะถะตะฝะธะธ eShopOnContainers ะฒัะฟะพะปะฝัะตั ะฟัะพะฒะตัะบั ะฟะพะดะปะธะฝะฝะพััะธ ะธ ะฐะฒัะพัะธะทะฐัะธะธ ั ะฟะพะผะพััั ะผะธะบัะพัะปัะถะฑั ะบะพะฝัะตะนะฝะตัะฝัั ัะดะพััะพะฒะตัะตะฝะธะน, ะบะพัะพัะฐั ะธัะฟะพะปัะทัะตั IdentityServer 4. IdentityServer โ ััะพ ะฟะปะฐััะพัะผะฐ ั ะพัะบััััะผ ะธััะพะดะฝัะผ OpenID Connect ะธ OAuth 2.0 ะดะปั ASP.NET Core, ะบะพัะพัะพะต ะธะฝัะตะณัะธััะตััั ั ัะดะพััะพะฒะตัะตะฝะธะตะผ ASP.NET Core ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ัะพะบะตะฝะฐ ะฝะพัะธัะตะปั.

ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะทะฐะฟัะฐัะธะฒะฐะตั ั IdentityServer, ะผะฐัะบะตัั ะฑะตะทะพะฟะฐัะฝะพััะธ, ะดะปั ะฟัะพะฒะตัะบะธ ะฟะพะดะปะธะฝะฝะพััะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะปะธ ะดะปั ะดะพัััะฟะฐ ะบ ัะตััััั. ะัะธ ะดะพัััะฟะต ะบ ัะตััััั, ะผะฐัะบะตั ะดะพัััะฟะฐ ะดะพะปะถะตะฝ ะฑััั ะฒะบะปััะตะฝ ะฒ ะทะฐะฟัะพัะต ะบ API, ััะตะฑัััะธะต ะฐะฒัะพัะธะทะฐัะธะธ. ะะพ ะฟัะพะผะตะถััะพัะฝะพะณะพ ัะปะพั ัะตัะฒะตั ะฟัะพะฒะตััะตั ะฒัะพะดััะธะต ะผะฐัะบะตัั ะดะพัััะฟะฐ, ััะพะฑั ัะฑะตะดะธัััั, ััะพ ะพะฝะธ ะฟะตัะตะดะฐัััั ะพั ะดะพะฒะตัะตะฝะฝะพะณะพ ะธะทะดะฐัะตะปั, ะธ ััะพ ะพะฝะธ ัะฒะปััััั ะดะพะฟัััะธะผัะผะธ ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ั API, ะบะพัะพััะน ะธั ะฟะพะปััะฐะตั.


## <a name="related-links"></a>ะกะฒัะทะฐะฝะฝัะต ัััะปะบะธ

- [ะกะบะฐัะฐะนัะต ัะปะตะบััะพะฝะฝัั ะบะฝะธะณั (2 ะะ ะฒ ัะพัะผะฐัะต PDF)](https://aka.ms/xamarinpatternsebook)
- [eShopOnContainers (GitHub) (ะฟัะธะผะตั)](https://github.com/dotnet-architecture/eShopOnContainers)
