---
title: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
description: –í –¥–∞–Ω–Ω–æ–π –≥–ª–∞–≤–µ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è, –∫–∞–∫ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –º–∏–∫—Ä–æ—Å–ª—É–∂–±.
ms.prod: xamarin
ms.assetid: e3f27b4c-f7f5-4839-a48c-30bcb919c59e
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 08/08/2017
ms.openlocfilehash: beb9e8f351a1cecc6017a08345f7cfc5e207ba35
ms.sourcegitcommit: 6e955f6851794d58334d41f7a550d93a47e834d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/12/2018
ms.locfileid: "38996221"
---
# <a name="authentication-and-authorization"></a>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–º—è –∏ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–∏—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π. –ï—Å–ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã, —Å—É—â–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—à–µ–¥—à–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∏–º–µ–µ—Ç –ª–∏ —ç—Ç–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ—Å—É—Ä—Å—É.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Xamarin.Forms, –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ASP.NET MVC, –≤–∫–ª—é—á–∞—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤–Ω–µ—à–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä Microsoft, Google, —Å –ø–æ–º–æ—â—å—é ASP.NET Core Identity Facebook –∏–ª–∏ Twitter –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è. –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –º–∏–∫—Ä–æ—Å–ª—É–∂–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç IdentityServer 4. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É IdentityServer, –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É. –î–ª—è IdentityServer –¥–ª—è –≤—ã–¥–∞—á–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ –∫ IdentityServer. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤ –æ–±—Ä–∞–∑—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers, –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ ASP.NET Core.

## <a name="authentication"></a>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑–≤–µ—Å—Ç–Ω–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. ASP.NET Core –æ—Å–Ω–æ–≤–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —è–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ —á–ª–µ–Ω—Å—Ç–≤–∞ ASP.NET Core Identity, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —ç—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ EntityFramework, —Ö–æ—Ç—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏–ª–∏ –ø–∞–∫–µ—Ç—ã —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Azure, Azure Cosmos DB –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

–°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å–≤–µ–¥–µ–Ω–∏—è –æ–± —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è—Ö –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å –ø–æ–º–æ—â—å—é —Ñ–∞–π–ª–æ–≤ cookie (–∫–∞–∫ –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—Ç –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ASP.NET MVC), —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ ASP.NET Core ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Ñ–∞–π–ª—ã cookie –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω–µ—Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ù–∞–ø—Ä–∏–º–µ—Ä –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ASP.NET Core, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful –∫–æ–Ω–µ—á–Ω—ã—Ö —Ç–æ—á–µ–∫, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–æ—Å–∏—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ —Ñ–∞–π–ª—ã cookie –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Ç–æ–∫–µ–Ω—ã –Ω–æ—Å–∏—Ç–µ–ª—è –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∞—Ç—å –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤, —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

### <a name="issuing-bearer-tokens-using-identityserver-4"></a>–í—ã–¥–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –Ω–æ—Å–∏—Ç–µ–ª—è, —Å –ø–æ–º–æ—â—å—é IdentityServer 4

[IdentityServer 4](https://github.com/IdentityServer/IdentityServer4) ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∫–æ–¥–æ–º OpenID Connect –∏ OAuth 2.0 –¥–ª—è ASP.NET Core, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –≤—ã–¥–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è ASP.NET Core.

> [!NOTE]
> OpenID Connect –∏ OAuth 2.0 –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏, –∏–º–µ—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏.

OpenID Connect –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ OAuth 2.0. OAuth 2 ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –º–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ –æ—Ç —Å–ª—É–∂–±—ã –º–∞—Ä–∫–µ—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ API. –≠—Ç–æ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã API, —Ç–∞–∫ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–°–æ—á–µ—Ç–∞–Ω–∏–µ OpenID Connect –∏ OAuth 2.0 –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–≤–µ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å–Ω–æ–≤–æ–ø–æ–ª–∞–≥–∞—é—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ API –∏ IdentityServer 4 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø—Ä—è–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±–æ–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –º–∏–∫—Ä–æ—Å–ª—É–∂–±–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–ª—É–∂–±—ã (STS) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å. 9-1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø—Ä—è–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±–æ–π, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –ú–∏–∫—Ä–æ—Å–ª—É–∂–±](~/xamarin-forms/enterprise-application-patterns/containerized-microservices.md#communication_between_client_and_microservices).

![](authentication-and-authorization-images/authentication.png "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –º–∏–∫—Ä–æ—Å–ª—É–∂–±–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏")

**–†–∏—Å. 9-1:** –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –º–∏–∫—Ä–æ—Å–ª—É–∂–±–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±—ã –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 4 identityserver –¥–æ–ª–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ API. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã —É IdentityServer, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É:

-   –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å identityserver –¥–æ–ª–∂–Ω–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å–∏–≤ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ *—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π* –º–∞—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ú–∏–Ω–∏–º—É–º –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –∏ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –û–Ω —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
-   –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É —Å identityserver –¥–æ–ª–∂–Ω–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å–∏–≤ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ *–¥–æ—Å—Ç—É–ø–∞* –º–∞—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É API. –ö–ª–∏–µ–Ω—Ç—ã, –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∏—Ö –≤ API. –ú–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–≤–µ–¥–µ–Ω–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø—Ä–∏ –µ–≥–æ –Ω–∞–ª–∏—á–∏–∏). API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Ö –¥–∞–Ω–Ω—ã–º.

> [!NOTE]
> –ö–ª–∏–µ–Ω—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å identityserver –¥–æ–ª–∂–Ω–æ, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ–Ω –º–æ–∂–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –º–∞—Ä–∫–µ—Ä—ã.

### <a name="adding-identityserver-to-a-web-application"></a>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ IdentityServer –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ß—Ç–æ–±—ã –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ASP.NET Core –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è IdentityServer 4 –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–µ Visual Studio –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–û–±–∑–æ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](https://identityserver4.readthedocs.io/en/release/quickstarts/0_overview.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer.

–ü–æ—Å–ª–µ IdentityServer –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ—à–µ–Ω–∏–µ Visual Studio –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ–Ω–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –∫–æ–Ω–µ—á–Ω—ã–º —Ç–æ—á–∫–∞–º OpenID Connect –∏ OAuth 2.0. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ `Configure` –º–µ—Ç–æ–¥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `Startup` –∫–ª–∞—Å—Å–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
public void Configure(  
    IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)  
{  
    ...  
    app.UseIdentity();  
    ...  
}
```

–ü–æ—Ä—è–¥–æ–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º IdentityServer –¥–æ–ª–∂–Ω—ã –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –≤ –∫–æ–Ω–≤–µ–π–µ—Ä, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞.

### <a name="configuring-identityserver"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ IdentityServer

IdentityServer –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `ConfigureServices` –º–µ—Ç–æ–¥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `Startup` –∫–ª–∞—Å—Å –ø—É—Ç–µ–º –≤—ã–∑–æ–≤–∞ `services.AddIdentityServer` –º–µ—Ç–æ–¥, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers:

```csharp
public void ConfigureServices(IServiceCollection services)  
{  
    ...  
    services.AddIdentityServer(x => x.IssuerUri = "null")  
        .AddSigningCredential(Certificate.Get())                 
        .AddAspNetIdentity<ApplicationUser>()  
        .AddConfigurationStore(builder =>  
            builder.UseSqlServer(connectionString, options =>  
                options.MigrationsAssembly(migrationsAssembly)))  
        .AddOperationalStore(builder =>  
            builder.UseSqlServer(connectionString, options =>  
                options.MigrationsAssembly(migrationsAssembly)))  
        .Services.AddTransient<IProfileService, ProfileService>();  
}
```

–ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ `services.AddIdentityServer` –º–µ—Ç–æ–¥, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–∫—É—á–µ–≥–æ API:

-   –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å—ã–≤–∞–Ω–∏—è.
-   –†–µ—Å—É—Ä—Å—ã API –∏ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫.
-   –ö–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –º–∞—Ä–∫–µ—Ä–æ–≤.
-   –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ ASP.NET Core.

>üí° **–°–æ–≤–µ—Ç**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é IdentityServer 4. IdentityServer 4 API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ –ø–∞–º—è—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –í –æ–±—Ä–∞–∑—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers —ç—Ç–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ –ø–∞–º—è—Ç–∏ –∂–µ—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ –≤ —Ä–∞–±–æ—á–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Ö –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ identityserver –¥–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è ASP.NET Core, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Å –ø–æ–º–æ—â—å—é ASP.NET Core Identity](https://identityserver4.readthedocs.io/en/release/quickstarts/6_aspnet_identity.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer.

#### <a name="configuring-api-resources"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ API

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ API `AddInMemoryApiResources` –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ `IEnumerable<ApiResource>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í —Å–ª–µ–¥—É—é—â–µ–º –∫–æ–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ `GetApis` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<ApiResource> GetApis()  
{  
    return new List<ApiResource>  
    {  
        new ApiResource("orders", "Orders Service"),  
        new ApiResource("basket", "Basket Service")  
    };  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å–ª–µ–¥—É–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å, –∑–∞–∫–∞–∑–æ–≤ –∏ –∫–æ—Ä–∑–∏–Ω—ã API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, IdentityServer —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –¥–æ—Å—Ç—É–ø –º–∞—Ä–∫–µ—Ä—ã –±—É–¥—É—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã–∑–æ–≤–æ–≤ –∫ —ç—Ç–∏–º API. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ `ApiResource` –≤–≤–µ–¥–∏—Ç–µ, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ä–µ—Å—É—Ä—Å–∞ API](https://identityserver4.readthedocs.io/en/release/reference/api_resource.html#refapiresource) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

#### <a name="configuring-identity-resources"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π `AddInMemoryIdentityResources` –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ `IEnumerable<IdentityResource>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –†–µ—Å—É—Ä—Å—ã —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º—è –∏–ª–∏ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã. –ö–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤–∫–ª—é—á–µ–Ω—ã –≤ –º–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í —Å–ª–µ–¥—É—é—â–µ–º –∫–æ–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ `GetResources` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<IdentityResource> GetResources()  
{  
    return new List<IdentityResource>  
    {  
        new IdentityResources.OpenId(),  
        new IdentityResources.Profile()  
    };  
}
```

–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenID Connect –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ [—Ä–µ—Å—É—Ä—Å—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è](https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims). –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è –≤—ã–¥–∞—á–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è `IdentityResources.OpenId` —Ä–µ—Å—É—Ä—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.

> [!NOTE]
> `IdentityResources` –ö–ª–∞—Å—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ–±–ª–∞—Å—Ç–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenID Connect (openid, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –ø—Ä–æ—Ñ–∏–ª—å, —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∞–¥—Ä–µ—Å).

IdentityServer —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π —Ä–µ—Å—É—Ä—Å–æ–≤. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π —Ä–µ—Å—É—Ä—Å–æ–≤](https://identityserver4.readthedocs.io/en/release/topics/resources.html#defining-custom-identity-resources) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ `IdentityResource` –≤–≤–µ–¥–∏—Ç–µ, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ä–µ—Å—É—Ä—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤](https://identityserver4.readthedocs.io/en/release/reference/identity_resource.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

#### <a name="configuring-clients"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

–ö–ª–∏–µ–Ω—Ç—ã —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –º–∞—Ä–∫–µ—Ä—ã –∏–∑ IdentityServer. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –º–∏–Ω–∏–º—É–º:

-   –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.
-   –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–æ —Å–ª—É–∂–±–æ–π –º–∞—Ä–∫–µ—Ä–æ–≤ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ —Ç–∏–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è).
-   –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –≥–¥–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è).
-   –°–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ (–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ –æ–±–ª–∞—Å—Ç–∏).

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤, `AddInMemoryClients` –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ `IEnumerable<Client>` –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers –≤ `GetClients` –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ eShopOnContainers –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:

```csharp
public static IEnumerable<Client> GetClients(Dictionary<string,string> clientsUrl)
{
    return new List<Client>
    {
        ...
        new Client
        {
            ClientId = "xamarin",
            ClientName = "eShop Xamarin OpenId Client",
            AllowedGrantTypes = GrantTypes.Hybrid,
            ClientSecrets =
            {
                new Secret("secret".Sha256())
            },
            RedirectUris = { clientsUrl["Xamarin"] },
            RequireConsent = false,
            RequirePkce = true,
            PostLogoutRedirectUris = { $"{clientsUrl["Xamarin"]}/Account/Redirecting" },
            AllowedCorsOrigins = { "http://eshopxamarin" },
            AllowedScopes = new List<string>
            {
                IdentityServerConstants.StandardScopes.OpenId,
                IdentityServerConstants.StandardScopes.Profile,
                IdentityServerConstants.StandardScopes.OfflineAccess,
                "orders",
                "basket"
            },
            AllowOfflineAccess = true,
            AllowAccessTokensViaBrowser = true
        },
        ...
    };
}
```

–≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤:

-   `ClientId`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.
-   `ClientName`: –ö–ª–∏–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ –∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–æ–≥–ª–∞—Å–∏—è.
-   `AllowedGrantTypes`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å identityserver –¥–æ–ª–∂–Ω–æ. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏](#configuring_the_authentication_flow).
-   `ClientSecrets`: –£–∫–∞–∑—ã–≤–∞–µ—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –æ—Ç –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤.
-   `RedirectUris`: –£–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π URI, –∫ –∫–æ—Ç–æ—Ä—ã–º –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –∏–ª–∏ –∫–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
-   `RequireConsent`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ª–∏ —ç–∫—Ä–∞–Ω —Å–æ–≥–ª–∞—Å–∏—è.
-   `RequirePkce`: –ü—Ä–∏–∑–Ω–∞–∫, –∫–ª–∏–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª—é—á–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏.
-   `PostLogoutRedirectUris`: –£–∫–∞–∑—ã–≤–∞–µ—Ç URI, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞.
-   `AllowedCorsOrigins`: –£–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫, –∫–ª–∏–µ–Ω—Ç–∞, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.
-   `AllowedScopes`: –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–º –∫–ª–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª—é–±—ã–º —Ä–µ—Å—É—Ä—Å–∞–º.
-   `AllowOfflineAccess`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –º–∞—Ä–∫–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

<a name="configuring_the_authentication_flow" />

#### <a name="configuring-the-authentication-flow"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–ü–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ IdentityServer –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, —É–∫–∞–∑–∞–≤ —Ç–∏–ø–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ `Client.AllowedGrantTypes` —Å–≤–æ–π—Å—Ç–≤–æ. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenID Connect –∏ OAuth 2.0 –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è:

-   –ù–µ—è–≤–Ω—ã–µ. –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –º–∞—Ä–∫–µ—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –º–∞—Ä–∫–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã.
-   –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –æ—Ç —á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞ –±—Ä–∞—É–∑–µ—Ä–∞, —Ç–æ –∂–µ –≤—Ä–µ–º—è —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞.
-   –ì–∏–±—Ä–∏–¥–Ω—ã–π. –≠—Ç–æ—Ç –ø–æ—Ç–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ—á–µ—Ç–∞–Ω–∏–µ –Ω–µ—è–≤–Ω—ã–π –∏ —Ç–∏–ø—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ú–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ –∫–∞–Ω–∞–ª—É –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–≤–µ—Ç —Å–æ –∑–Ω–∞–∫–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∞ —Ç–∞–∫–∂–µ –¥—Ä—É–≥–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ —Ç–æ–∫–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

> [!TIP]
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ü–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ç–∞–∫, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –∫ –∫–∞–Ω–∞–ª—É –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ (–∏ –≤–æ–∑–º–æ–∂–Ω–æ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è).

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ—Ç–æ–∫–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—Ç–∏–ø—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è](https://identityserver4.readthedocs.io/en/release/topics/grant_types.html) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ IdentityServer 4.

### <a name="performing-authentication"></a>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–î–ª—è IdentityServer –¥–ª—è –≤—ã–¥–∞—á–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ –∫ IdentityServer. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤ –æ–±—Ä–∞–∑—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers, –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ ASP.NET Core.

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å identityserver –¥–æ–ª–∂–Ω–æ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-2.

![](authentication-and-authorization-images/sign-in.png "–û–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É")

**–†–∏—Å. 9-2:** –æ–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É

–°–¥–µ–ª–∞–Ω –∑–∞–ø—Ä–æ—Å –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É –Ω–∞ `<base endpoint>:5105/connect/authorize`. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ç–æ–∫–µ–Ω —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è. –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `<base endpoint>:5105/connect/token`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º, —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è –∏ –º–∞—Ä–∫–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

EShopOnContainers –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–∫–∏ –≥–æ—Ç–æ–≤–æ–π IdentityServer, –æ—Ç–ø—Ä–∞–≤–∏–≤ –∑–∞–ø—Ä–æ—Å –Ω–∞ `<base endpoint>:5105/connect/endsession`, —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞, —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è—è URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ —Ä–∏—Å. 9-3.

![](authentication-and-authorization-images/sign-out.png "–û–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã—Ö–æ–¥–∞")

**–†–∏—Å. 9-3:** –æ–±—â–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã—Ö–æ–¥–∞

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers, –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å identityserver –¥–æ–ª–∂–Ω–æ `IdentityService` –∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç `IIdentityService` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –≠—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å `CreateAuthorizationRequest`, `CreateLogoutRequest`, –∏ `GetTokenAsync` –º–µ—Ç–æ–¥—ã.

#### <a name="signing-in"></a>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞—Å–∞–µ—Ç—Å—è **–≤—Ö–æ–¥–∞** –∫–Ω–æ–ø–∫—É `LoginView`, `SignInCommand` –≤ `LoginViewModel` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `SignInAsync` –º–µ—Ç–æ–¥. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω —ç—Ç–æ—Ç –º–µ—Ç–æ–¥.

```csharp
private async Task SignInAsync()  
{  
    ...  
    LoginUrl = _identityService.CreateAuthorizationRequest();  
    IsLogin = true;  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `CreateAuthorizationRequest` –º–µ—Ç–æ–¥ –≤ `IdentityService` –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
public string CreateAuthorizationRequest()
{
    // Create URI to authorization endpoint
    var authorizeRequest = new AuthorizeRequest(GlobalSetting.Instance.IdentityEndpoint);

    // Dictionary with values for the authorize request
    var dic = new Dictionary<string, string>();
    dic.Add("client_id", GlobalSetting.Instance.ClientId);
    dic.Add("client_secret", GlobalSetting.Instance.ClientSecret); 
    dic.Add("response_type", "code id_token");
    dic.Add("scope", "openid profile basket orders locations marketing offline_access");
    dic.Add("redirect_uri", GlobalSetting.Instance.IdentityCallback);
    dic.Add("nonce", Guid.NewGuid().ToString("N"));
    dic.Add("code_challenge", CreateCodeChallenge());
    dic.Add("code_challenge_method", "S256");

    // Add CSRF token to protect against cross-site request forgery attacks.
    var currentCSRFToken = Guid.NewGuid().ToString("N");
    dic.Add("state", currentCSRFToken);

    var authorizeUri = authorizeRequest.Create(dic); 
    return authorizeUri;
}

```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç URI –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ IdentityServer [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](https://identityserver4.readthedocs.io/en/release/endpoints/authorize.html), —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/connect/authorize` –Ω–∞ –ø–æ—Ä—Ç–µ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–æ–¥–æ–º (PKCE) —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è OAuth. PKCE –∑–∞—â–∏—â–∞–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞ verifier, —Ö—ç—à –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫–ª–∏–µ–Ω—Ç –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ PKCE, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–∫–ª—é—á –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∫–æ–¥–∞ Exchange —Å –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ OAuth](https://tools.ietf.org/html/rfc7636) –≤–µ–±-—Å–∞–π—Ç–µ Internet Engineering Task Force.

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π URI —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞. –ö–æ–≥–¥–∞ `IsLogin` —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `true`, [ `WebView` ](xref:Xamarin.Forms.WebView) –≤ `LoginView` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º—ã–º. `WebView` –û—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –µ–≥–æ [ `Source` ](xref:Xamarin.Forms.WebView.Source) —Å–≤–æ–π—Å—Ç–≤–∞ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –∏ –ø–æ—ç—Ç–æ–º—É IdentityServer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –í IdentityServer –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, `WebView` –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤—Ö–æ–¥–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-4.

![](authentication-and-authorization-images/login.png "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–º –≤–µ–±-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è")

**–†–∏—Å. 9-4:** —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–º –≤–µ–±-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ö–æ–¥–∞ [ `WebView` ](xref:Xamarin.Forms.WebView) –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ URI. –≠—Ç–æ `WebView` –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ `NavigateAsync` –º–µ—Ç–æ–¥ –≤ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private async Task NavigateAsync(string url)  
{  
    ...  
    var authResponse = new AuthorizeResponse(url);  
    if (!string.IsNullOrWhiteSpace(authResponse.Code))  
    {  
        var userToken = await _identityService.GetTokenAsync(authResponse.Code);  
        string accessToken = userToken.AccessToken;  

        if (!string.IsNullOrWhiteSpace(accessToken))  
        {  
            Settings.AuthAccessToken = accessToken;  
            Settings.AuthIdToken = authResponse.IdentityToken;  

            await NavigationService.NavigateToAsync<MainViewModel>();  
            await NavigationService.RemoveLastFromBackStackAsync();  
        }  
    }  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π—Å—è –≤ URI, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∏ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ IdentityServer [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞](https://identityserver4.readthedocs.io/en/release/endpoints/token.html), –ø–µ—Ä–µ–¥–∞–≤–∞—è –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –°—Ä–µ–¥—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ PKCE –¥–ª—è —Å–µ–∫—Ä–µ—Ç–∞ –∏ –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/connect/token` –Ω–∞ –ø–æ—Ä—Ç–µ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

>üí° **–°–æ–≤–µ—Ç**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã URI. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ URI, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ URI —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏, –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞—Ç–∞–∫ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

–ï—Å–ª–∏ –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π PKCE, –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞, –º–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –º–∞—Ä–∫–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ (–∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º API) –∏ –º–∞—Ä–∫–µ—Ä –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–±—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers —ç—Ç–æ: –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Å identityserver –¥–æ–ª–∂–Ω–æ, –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ `MainView` —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è [ `TabbedPage` ](xref:Xamarin.Forms.TabbedPage) –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π `CatalogView` –∫–∞–∫ –µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md). –°–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ [ `WebView` ](xref:Xamarin.Forms.WebView) –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–≤—ã–∑–æ–≤–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –ø–æ–≤–µ–¥–µ–Ω–∏–π](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). –°–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–∫–µ—Ç–æ–≤ –≤—Ö–æ–¥, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞–∫–µ—Ç—ã —Å–ª—É–∂–± –≤ `SettingsView`. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å IdentityServer, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, –ø–æ–∑–≤–æ–ª—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—Ö–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

#### <a name="signing-out"></a>–ü–æ–¥–ø–∏—Å—ã–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞—Å–∞–µ—Ç—Å—è **–í—ã—Ö–æ–¥** –∫–Ω–æ–ø–∫—É `ProfileView`, `LogoutCommand` –≤ `ProfileViewModel` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `LogoutAsync` –º–µ—Ç–æ–¥. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –¥–ª—è `LoginView` —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø–µ—Ä–µ–¥–∞–≤ `LogoutParameter` —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–Ω–∞—á–µ–Ω–∏–µ `true` –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–µ—Ä–µ–¥–∞—á–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md#passing_parameters_during_navigation).

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥, `InitializeAsync` —Å–≤—è–∑–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç `Logout` –º–µ—Ç–æ–¥ `LoginViewModel` –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private void Logout()  
{  
    var authIdToken = Settings.AuthIdToken;  
    var logoutRequest = _identityService.CreateLogoutRequest(authIdToken);  

    if (!string.IsNullOrEmpty(logoutRequest))  
    {  
        // Logout  
        LoginUrl = logoutRequest;  
    }  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `CreateLogoutRequest` –º–µ—Ç–æ–¥ –≤ `IdentityService` –∫–ª–∞—Å—Å–∞, –ø–µ—Ä–µ–¥–∞–≤–∞—è –º–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md). –í —Å–ª–µ–¥—É—é—â–µ–º –∫–æ–¥–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ `CreateLogoutRequest` –º–µ—Ç–æ–¥:

```csharp
public string CreateLogoutRequest(string token)  
{  
    ...  
    return string.Format("{0}?id_token_hint={1}&post_logout_redirect_uri={2}",   
        GlobalSetting.Instance.LogoutEndpoint,  
        token,  
        GlobalSetting.Instance.LogoutCallback);  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç URI –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ IdentityServer [–∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ–∞–Ω—Å –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏](https://identityserver4.readthedocs.io/en/release/endpoints/endsession.html#refendsession), —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏. –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ–∞–Ω—Å–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/connect/endsession` –Ω–∞ –ø–æ—Ä—Ç–µ 5105 –±–∞–∑–æ–≤—ã–π –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π URI —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞. –•–æ—Ç—è `IsLogin` —Å–≤–æ–π—Å—Ç–≤–æ `true`, [ `WebView` ](xref:Xamarin.Forms.WebView) –≤ `LoginView` —è–≤–ª—è–µ—Ç—Å—è –≤–∏–¥–∏–º—ã–º. `WebView` –û—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –µ–≥–æ [ `Source` ](xref:Xamarin.Forms.WebView.Source) —Å–≤–æ–π—Å—Ç–≤–∞ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –∏ –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å –≤—ã—Ö–æ–¥–∞ –¥–ª—è IdentityServer –ø—Ä–∏ `LoginUrl` —Å–≤–æ–π—Å—Ç–≤–æ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –í IdentityServer –∫–æ–Ω–µ—á–Ω–æ–π —Å–µ–∞–Ω—Å–∞. –ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≤—ã–ø–æ–ª–Ω–∏–≤—à–∏–π –≤—Ö–æ–¥, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã—Ö–æ–¥. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —Å —Ñ–∞–π–ª–æ–º cookie, —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞ cookie –∏–∑ ASP.NET Core. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤—ã–π–¥—è –∏–∑ IdentityServer —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª cookie –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞, URI –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ [ `WebView` ](xref:Xamarin.Forms.WebView) –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞. –≠—Ç–æ `WebView` –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ `NavigateAsync` –º–µ—Ç–æ–¥ –≤ `LoginViewModel` –∫–ª–∞—Å—Å–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
private async Task NavigateAsync(string url)  
{  
    ...  
    Settings.AuthAccessToken = string.Empty;  
    Settings.AuthIdToken = string.Empty;  
    IsLogin = false;  
    LoginUrl = _identityService.CreateAuthorizationRequest();  
    ...  
}
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —É–¥–∞–ª—è–µ—Ç –º–∞—Ä–∫–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–¥–∞–µ—Ç `IsLogin` —Å–≤–æ–π—Å—Ç–≤–∞ `false`, —á–µ–≥–æ [ `WebView` ](xref:Xamarin.Forms.WebView) –Ω–∞ `LoginView` —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–∏–¥–∏–º–æ–π . –ù–∞–∫–æ–Ω–µ—Ü `LoginUrl` —Å–≤–æ–π—Å—Ç–≤—É IdentityServer URI –∏–∑ [–∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](https://identityserver4.readthedocs.io/en/release/endpoints/authorize.html), —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É.

–°–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–Ω–∞–≤–∏–≥–∞—Ü–∏–∏](~/xamarin-forms/enterprise-application-patterns/navigation.md). –°–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ [ `WebView` ](xref:Xamarin.Forms.WebView) –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–≤—ã–∑–æ–≤–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –ø–æ–≤–µ–¥–µ–Ω–∏–π](~/xamarin-forms/enterprise-application-patterns/navigation.md#invoking_navigation_using_behaviors). –°–≤–µ–¥–µ–Ω–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](~/xamarin-forms/enterprise-application-patterns/configuration-management.md).

> [!NOTE]
> EShopOnContainers —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ SettingsView –º–∞–∫–µ—Ç—ã —Å–ª—É–∂–±. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å identityserver –¥–æ–ª–∂–Ω–æ –∏ –≤–º–µ—Å—Ç–æ –æ—á–∏—â–∞–µ—Ç –≤—Å–µ —Ö—Ä–∞–Ω–∏–º—ã–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

<a name="authorization" />

## <a name="authorization"></a>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –≤–µ–±-ASP.NET Core, —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–ª—É–∂–±–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã API –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –ø—Ä–æ—à–µ–¥—à–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ –Ω–µ –≤—Å–µ–º.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Ä—à—Ä—É—Ç—É ASP.NET Core MVC –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –ø—É—Ç–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ Authorize –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–æ—à–µ–¥—à–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
[Authorize]  
public class BasketController : Controller  
{  
    ...  
}
```

–ï—Å–ª–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—é, –æ—Ç–º–µ—á–µ–Ω–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç–æ–º `Authorize` –∞—Ç—Ä–∏–±—É—Ç, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ MVC –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è 401 (–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π) HTTP.

> [!NOTE]
> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–¥–∞–Ω—ã –Ω–∞ `Authorize` –∞—Ç—Ä–∏–±—É—Ç–∞ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](/aspnet/core/security/authorization/introduction/).

IdentityServer –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —á—Ç–æ–±—ã –º–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞, –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ —Ä–∏—Å—É–Ω–∫–µ 9-5.

![](authentication-and-authorization-images/authorization.png "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—Ä–∫–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞")

**–†–∏—Å. 9-5:** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—Ä–∫–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞

–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –º–∏–∫—Ä–æ—Å–ª—É–∂–±—ã –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∫–∞–∫ —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏. –ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è API, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö –º–∏–∫—Ä–æ—Å–ª—É–∂–± —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è –∏ –∫–æ—Ä–∑–∏–Ω—ã –∫–∞–∫ —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø. –ú–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Ö –¥–∞–Ω–Ω—ã–º. –°–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ API](#configuring-api-resources).

### <a name="configuring-identityserver-to-perform-authorization"></a>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ IdentityServer –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å identityserver –¥–æ–ª–∂–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –∫–æ–Ω–≤–µ–π–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `ConfigureAuth` –º–µ—Ç–æ–¥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `Startup` –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `Configure` –º–µ—Ç–æ–¥ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –∏–∑ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers:

```csharp
protected virtual void ConfigureAuth(IApplicationBuilder app)  
{  
    var identityUrl = Configuration.GetValue<string>("IdentityUrl");  
    app.UseIdentityServerAuthentication(new IdentityServerAuthenticationOptions  
    {  
        Authority = identityUrl.ToString(),  
        ScopeName = "basket",  
        RequireHttpsMetadata = false  
    });  
} 
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ API –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å –Ω–∞–¥–µ–∂–Ω—ã–º –∏–∑–¥–∞—Ç–µ–ª–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –º–∞—Ä–∫–µ—Ä —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å API, –∫–æ—Ç–æ—Ä–∞—è –µ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ–π–¥—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ –∏–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã –≤–µ—Ä–Ω–µ—Ç (–Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö) –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è HTTP 401, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ, —á—Ç–æ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

> [!NOTE]
> –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º MVC —Å `app.UseMvc()` –∏–ª–∏ `app.UseMvcWithDefaultRoute()`.

### <a name="making-access-requests-to-apis"></a>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º API

–ü—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–∏–∫—Ä–æ—Å–ª—É–∂–± —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è –∏ –∫–æ—Ä–∑–∏–Ω—ã, –¥–æ—Å—Ç—É–ø –º–∞—Ä–∫–µ—Ä, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ IdentityServer –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
var authToken = Settings.AuthAccessToken;  
Order = await _ordersService.GetOrderAsync(Convert.ToInt32(order.OrderNumber), authToken);
```

–ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≤–∏–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –≤—ã–∑–æ–≤–µ `GetOrderAsync` –º–µ—Ç–æ–¥ –≤ `OrderService` –∫–ª–∞—Å—Å–∞.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö IdentityServer –∑–∞—â–∏—Ç–µ API, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
var authToken = Settings.AuthAccessToken;  
await _basketService.UpdateBasketAsync(new CustomerBasket  
{  
    BuyerId = userInfo.UserId,   
    Items = BasketItems.ToList()  
}, authToken);
```

–ú–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∑–∞–≤–∏—Å—è—â–µ–µ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –≤—ã–∑–æ–≤–µ `UpdateBasketAsync` –º–µ—Ç–æ–¥ –≤ `BasketService` –∫–ª–∞—Å—Å–∞.

`RequestProvider` –ö–ª–∞—Å—Å, –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HttpClient` –∫–ª–∞—Å—Å–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ RESTful, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –≤ –æ–±—Ä–∞–∑—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è eShopOnContainers. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∑–∞–∫–∞–∑ –∏ –∫–æ—Ä–∑–∏–Ω—ã API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –Ω–∞–ª–∏—á–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å. –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º `HttpClient` —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞:

```csharp
httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
```

`DefaultRequestHeaders` –°–≤–æ–π—Å—Ç–≤–æ `HttpClient` –∫–ª–∞—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º, –∏ –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `Authorization` –ø—Ä–µ—Ñ–∏–∫—Å–æ–º —Å–æ —Å—Ç—Ä–æ–∫–æ–π –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Bearer`. –û—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ RESTful, –∑–Ω–∞—á–µ–Ω–∏–µ `Authorization` –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑–¥–∞—Ç–µ–ª—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤—ã–∑–æ–≤ API, –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ–±-–∑–∞–ø—Ä–æ—Å—ã, —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ [–¥–æ—Å—Ç—É–ø –∫ —É–¥–∞–ª–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º](~/xamarin-forms/enterprise-application-patterns/accessing-remote-data.md).

## <a name="summary"></a>–°–≤–æ–¥–∫–∞

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Xamarin.Forms, –∫–æ—Ç–æ—Ä–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ASP.NET MVC. –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ eShopOnContainers –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –º–∏–∫—Ä–æ—Å–ª—É–∂–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç IdentityServer 4. IdentityServer ‚Äî —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º OpenID Connect –∏ OAuth 2.0 –¥–ª—è ASP.NET Core, –∫–æ—Ç–æ—Ä–æ–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ–º ASP.NET Core –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–æ—Å–∏—Ç–µ–ª—è.

–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É IdentityServer, –º–∞—Ä–∫–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É. –ü—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —Ä–µ—Å—É—Ä—Å—É, –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ API, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏–∑–¥–∞—Ç–µ–ª—è, –∏ —á—Ç–æ –æ–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å API, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö –ø–æ–ª—É—á–∞–µ—Ç.


## <a name="related-links"></a>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–°–∫–∞—á–∞–π—Ç–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –∫–Ω–∏–≥—É (2 –ú–ë –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF)](https://aka.ms/xamarinpatternsebook)
- [eShopOnContainers (GitHub) (–ø—Ä–∏–º–µ—Ä)](https://github.com/dotnet-architecture/eShopOnContainers)
