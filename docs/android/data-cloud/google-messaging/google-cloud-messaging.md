---
title: Google Cloud Messaging
description: Google Cloud Messaging (GCM) — это служба, которая облегчает обмен сообщениями между мобильные приложения и серверные приложения. В этой статье представлен обзор принципов работы GCM, и здесь объясняется, как настроить службы Google, чтобы приложения могли использовать GCM.
ms.prod: xamarin
ms.assetid: DF8EF401-F63D-4BA0-B2C6-B22DF8FD60CB
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 04/12/2018
ms.openlocfilehash: c2ca567ffcb247622d1b3e8f3e0136c453723b96
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50119115"
---
# <a name="google-cloud-messaging"></a>Google Cloud Messaging

_Google Cloud Messaging (GCM) — это служба, которая облегчает обмен сообщениями между мобильные приложения и серверные приложения. В этой статье представлен обзор принципов работы GCM, и здесь объясняется, как настроить службы Google, чтобы приложения могли использовать GCM._

[![Логотип Google Cloud Messaging](google-cloud-messaging-images/preview-sml.png)](google-cloud-messaging-images/preview.png#lightbox)

В этом разделе представлен общий обзор как Google Cloud Messaging маршрутизирует сообщения между приложением и сервером приложений, а также пошаговая процедура для получения учетных данных, таким образом, чтобы ваше приложение может использовать службы GCM.

> [!NOTE]
> GCM была заменена [Firebase Cloud Messaging](~/android/data-cloud/google-messaging/firebase-cloud-messaging.md) (FCM).
> GCM сервер и клиентские API-интерфейсы [стали нерекомендуемыми](https://firebase.googleblog.com/2018/04/time-to-upgrade-from-gcm-to-fcm.html) и больше не будут доступны как можно скорее 11 апреля 2019 г.

## <a name="overview"></a>Обзор

Google Cloud Messaging (GCM) — это служба, который обрабатывает отправку, маршрутизации и их постановку в очередь сообщений между серверных приложений и мобильных клиентских приложений. Объект *клиентское приложение* — приложение с поддержкой GCM, которое выполняется на устройстве. *Сервера приложений* (предоставляемое вы или ваша организация) — это сервер с поддержкой GCM, клиентское приложение обменивается данными с помощью GCM:

[![GCM находится между приложением клиента и сервера приложений](google-cloud-messaging-images/01-server-gcm-app-sml.png)](google-cloud-messaging-images/01-server-gcm-app.png#lightbox)

С помощью GCM, серверы приложений может отправлять сообщения для одного устройства группе устройств и нескольких устройств, которые подписаны на раздел. Клиентского приложения можно использовать GCM подписаться на подчиненных сообщения с сервера приложений (например, для получения удаленных уведомлений). Кроме того GCM позволяет для клиентских приложений для передачи сообщений вышестоящего сервера приложений.

Сведения о реализации серверов приложений для GCM, см. в разделе [о сервере подключений GCM](https://developers.google.com/cloud-messaging/server).



## <a name="google-cloud-messaging-in-action"></a>Google Cloud Messaging в действии

Когда подчиненный сообщения отправляются с сервера приложений клиентского приложения, сервера приложений отправляет сообщение, *соединения сервера GCM*; сервере подключений GCM, в свою очередь, перенаправляет сообщение на устройство, на котором работает клиентское приложение. Сообщения могут отправляться по протоколу HTTP или [XMPP](https://developers.google.com/cloud-messaging/ccs) (Extensible обмена сообщениями и присутствия протокол). Поскольку клиентские приложения не всегда подключен или под управлением, GCM подключения сервера ставит в очередь и сохраняет сообщения, отправкой к клиентским приложениям, повторное подключение и становятся доступными. Аналогичным образом GCM будет постановки в очередь вышестоящего сообщений из клиентского приложения для сервера приложений в случае недоступности сервера приложений.

GCM использует следующие учетные данные для идентификации сервера приложений и клиентского приложения и использует эти учетные данные для авторизации операций сообщения через GCM:

-   **Ключ API** &ndash; *ключ API* предоставляет серверу доступ приложения к службам Google; GCM использует этот ключ для проверки подлинности сервера приложений.
    Перед использованием службы GCM, сначала необходимо получить ключ API из [Google Developer Console](https://console.developers.google.com/) путем создания *проекта*. Ключ API должны быть защищены; Дополнительные сведения о защите ключ API, см. в разделе [рекомендации по безопасным способом с помощью ключей API](https://support.google.com/cloud/answer/6310037?hl=en).

-   **Идентификатор отправителя** &ndash; *кода отправителя* авторизует сервера приложений для клиентского приложения &ndash; это уникальный номер, который идентифицирует используемый сервер приложения, имеет разрешение на отправку сообщений клиентского приложения.
    Идентификатор отправителя также — номер проекта; Вы можете получить идентификатор отправителя с Google Developers Console, при регистрации проекта.

-   **Маркер регистрации** &ndash; *токена регистрации* GCM удостоверение клиентского приложения на данном устройстве. Маркер регистрации создается во время выполнения &ndash; приложение получает маркер регистрации, при ее первой регистрации в GCM во время выполнения на устройстве. Маркер регистрации авторизует экземпляр клиентского приложения (для запуска на этом конкретном устройстве) для получения сообщений из GCM.

-   **Идентификатор приложения** &ndash; удостоверение клиентского приложения (независимо от любого устройства), зарегистрированный на получение сообщений из GCM. В Android, идентификатор приложения — это имя пакета, записанного в **AndroidManifest.xml**, такие как `com.xamarin.gcmexample`.

[Параметр вверх Google Cloud Messaging](#settingup) (Далее в этом руководстве) содержатся подробные инструкции по созданию проекта и создания этих учетных данных.

В следующих разделах объясняется, как используются эти учетные данные, когда клиентские приложения взаимодействуют с серверами приложений через GCM.



### <a name="registration-with-gcm"></a>Регистрации в GCM

Клиентского приложения, установленные на устройстве, сначала необходимо зарегистрировать в GCM, прежде чем обмена сообщениями может выполняться. Клиентское приложение необходимо выполнить действия по регистрации, показано на следующей схеме:

[![Действия для регистрации приложения](google-cloud-messaging-images/02-app-registration-sml.png)](google-cloud-messaging-images/02-app-registration.png#lightbox)

1.  Клиентское приложение обращается GCM, чтобы получить маркер регистрации, передав идентификатор отправителя в GCM.

2.  GCM возвращает маркер регистрации в клиентское приложение.

3.  Клиентское приложение отправляет токен регистрации для сервера приложений.

Сервер приложений кэширует маркер регистрации для последующих соединений с клиентским приложением. При необходимости сервера приложений могли отправлять подтверждение клиентское приложение, чтобы указать, что маркер регистрации было получено. После внесения это подтверждение, клиентское приложение может получать сообщения из (или отправлять сообщения) сервера приложений.

Когда клиентское приложение больше не хочет получать сообщения с сервера приложений, он может отправить запрос к серверу приложений, чтобы удалить маркер регистрации. Если клиентское приложение получает сообщения раздела (описывается далее в этой статье), он может отменить подписку на раздел.
Если клиентское приложение удаляется с устройства, GCM обнаружит это и автоматически уведомляет о том, чтобы удалить маркер регистрации сервера приложений.

Google [регистрации клиентских приложений](https://developers.google.com/cloud-messaging/registration) описание процесса регистрации более подробно; здесь объясняется, отмены регистрации и отмены подписки, и описывает процесс отмены регистрации, при удалении клиентского приложения.



### <a name="downstream-messaging"></a>Более низком уровне обмена сообщениями

Когда сервер приложение отправляет сообщение нисходящего потока в клиентское приложение, он состоит из этапов, показано на следующей схеме:

[![Прямой диаграмма и подчиненных хранилище обмена сообщениями](google-cloud-messaging-images/03-downstream-sml.png)](google-cloud-messaging-images/03-downstream.png#lightbox)

1.  Сервер приложений отправляет сообщение GCM.

2.  Если клиентское устройство не доступен, на сервере GCM хранятся сообщения в очередь для последующей передачи.

3.  Когда клиентское устройство станет доступным, GCM отправляет сообщение в клиентское приложение на этом устройстве.

4.  Клиентское приложение получает сообщение из GCM и обрабатывает ее соответствующим образом. Например если сообщение является удаленного уведомления, оно выводится пользователю.

В этом сценарии обмена сообщениями (где сервера приложений отправляет сообщение одного клиентского приложения) сообщения могут иметь длину до 4 КБ.

Подробные сведения (в том числе примеры кода) о получении подчиненных сообщений GCM в Android, см. в разделе [удаленные уведомления](~/android/data-cloud/google-messaging/remote-notifications-with-gcm.md).


#### <a name="topic-messaging"></a>Обмен сообщениями в разделе

*Раздел Messaging* — это разновидность подчиненных обмена сообщениями, где сервер приложений отправляет одно сообщение с множества мобильных устройств приложений, которые подписаны на раздел (например, прогноз погоды). Сообщения раздела может быть длиной до 2 КБ, а разделе обмена сообщениями поддерживает до миллиона подписок на приложение. Если GCM используется только для раздела обмена сообщениями, клиентского приложения не требуется для отправки маркера регистрации сервера приложений. Google [реализации обмена сообщениями разделе](https://developers.google.com/cloud-messaging/topic-messaging) объясняется, как отправлять сообщения с сервера приложения на несколько устройств, которые подписаны на определенный раздел.



#### <a name="group-messaging"></a>Группа системы обмена сообщениями

*Группе Messaging* — это разновидность подчиненных обмена сообщениями, где сервер приложений отправляет одно сообщение для множества приложений мобильных устройств, принадлежащих к группе (например, группы устройств, принадлежащих одному пользователю). Группа сообщений может быть размером до 2 КБ длиной для устройств iOS и до 4 КБ в длину для устройств Android. Группа — может превышать 20 элементов. Google [Device Messaging группы](https://developers.google.com/cloud-messaging/notifications) объясняет, как серверы приложений могут отправлять одно сообщение несколько экземпляров клиентского приложения, работающие на устройствах, принадлежащих к группе.


### <a name="upstream-messaging"></a>Вышестоящий источник обмена сообщениями

Если клиентское приложение подключается к серверу, который поддерживает [XMPP](https://developers.google.com/cloud-messaging/ccs), он может отправлять сообщения на сервер приложений, как показано на следующей схеме:

[![Вышестоящий схеме обмена сообщениями](google-cloud-messaging-images/04-upstream-sml.png)](google-cloud-messaging-images/04-upstream.png#lightbox)

1.  Клиентское приложение отправляет сообщение на сервер подключения GCM XMPP.

2.  При отключении сервера приложений на сервере GCM хранятся сообщения в очереди для пересылки, более поздней версии.

3.  Если повторно подключенный сервера приложений, GCM пересылает сообщение сервера приложений.

4.  Выполняет синтаксический анализ сообщения, чтобы проверить подлинность клиентского приложения для сервера приложений, а затем отправляет «подтверждение» GCM для подтверждения получения сообщения.

5.  Сервер приложений обрабатывает сообщение.

Google [вышестоящего сообщения](https://developers.google.com/cloud-messaging/ccs#upstream) объясняется, как структурировать сообщения с кодировкой JSON и отправляют их серверам приложений под управлением Server подключения облака на базе XMPP от Google.


<a name="settingup" />

## <a name="setting-up-google-cloud-messaging"></a>Настройка Google Cloud Messaging

Прежде чем GCM службы можно использовать в приложении, необходимо сначала получить учетные данные для доступа к серверам GCM от Google. В следующих разделах описаны шаги, необходимые для завершения этого процесса:



### <a name="enable-google-services-for-your-app"></a>Включение службы Google для приложения

1.  Войдите в [Google Developers Console](https://developers.google.com/mobile/add?platform=android) Google учетной записи (например, ваш адрес электронной почты gmail), а затем создайте новый проект. Если у вас есть существующий проект, выберите проект, который вы хотите стать GCM с поддержкой. В следующем примере вызывается проекта **XamarinGCM** создается:

    [![Создание проекта XamarinGCM](google-cloud-messaging-images/05-create-gcm-app-sml.png)](google-cloud-messaging-images/05-create-gcm-app.png#lightbox)

2.  Затем введите имя пакета для приложения (в данном случае является имя пакета **com.xamarin.gcmexample**) и нажмите кнопку **продолжить, чтобы выбрать и настроить службы**:

    [![Введите имя пакета](google-cloud-messaging-images/06-package-name-sml.png)](google-cloud-messaging-images/06-package-name.png#lightbox)

    Обратите внимание, что это имя пакета также идентификатор приложения для вашего приложения.

3.  **Выбор и настройка служб** разделе перечислены службы Google, которые можно добавить в приложение. Нажмите кнопку **Cloud Messaging**:

    [![Выберите облако обмена сообщениями](google-cloud-messaging-images/07-choose-gcm-service-sml.png)](google-cloud-messaging-images/07-choose-gcm-service.png#lightbox)

4.  Затем щелкните **ВКЛЮЧИТЬ GOOGLE CLOUD MESSAGING**:

    [![Включение Google Cloud Messaging](google-cloud-messaging-images/08-enable-gcm-sml.png)](google-cloud-messaging-images/08-enable-gcm.png#lightbox)

5.  Объект **ключ API сервера** и **кода отправителя** создаются для вашего приложения. Запишите эти значения и нажмите кнопку **ЗАКРЫТЬ**:

    [![Ключ API сервера и идентификатор отправителя, отображаемый](google-cloud-messaging-images/09-get-api-key-and-id-sml.png)](google-cloud-messaging-images/09-get-api-key-and-id.png#lightbox)

    Защитить ключ API &ndash; он не предназначен для общего использования. Если ключ API будет скомпрометирована, Неавторизованные серверы удалось публикуют сообщения для клиентских приложений.
    [Рекомендации по безопасным способом с помощью ключей API](https://support.google.com/cloud/answer/6310037?hl=en) предоставляет полезные рекомендации по защите ключ API.



### <a name="view-your-project-settings"></a>Просмотр параметров проекта

Параметры проекта можно просмотреть в любое время при входе в [консоли Google Cloud](https://console.cloud.google.com/) и выбрав проект. Например, можно просмотреть **кода отправителя** , выбрав проект в раскрывающемся меню в верхней части страницы (в этом примере проект называется **XamarinGCM**). Идентификатор отправителя — номер проекта, как показано на следующем снимке экрана (идентификатор отправителя **9349932736**):

[![Просмотр кода отправителя](google-cloud-messaging-images/10-view-server-id-sml.png)](google-cloud-messaging-images/10-view-server-id.png#lightbox)

Чтобы просмотреть **ключ API**, нажмите кнопку **API диспетчера** и нажмите кнопку **учетные данные**:

[![Просмотр ключа API](google-cloud-messaging-images/11-view-credentials-sml.png)](google-cloud-messaging-images/11-view-credentials.png#lightbox)



## <a name="for-further-reading"></a>Дополнительные сведения

-   Google [регистрации клиентских приложений](https://developers.google.com/cloud-messaging/registration) описывает процесс регистрации клиента, в частности, и предоставляет сведения о настройке автоматического повтора и синхронизация состояния регистрации.

-   [RFC 6120](https://tools.ietf.org/html/rfc6120) и [RFC 6121](https://tools.ietf.org/html/rfc6121) объяснить и определить расширяемый обмена сообщениями и присутствия протокола (XMPP).



## <a name="summary"></a>Сводка

В этой статье предоставляются общие сведения о из Google Cloud Messaging (GCM). Оно описывает различные учетные данные, которые используются для идентификации и авторизации, обмен сообщениями между серверами приложений и клиентских приложений. Она иллюстрирует наиболее распространенные сценарии обмена сообщениями и его подробные инструкции по регистрации приложения с помощью GCM для использования службы GCM.


## <a name="related-links"></a>Связанные ссылки

- [Cloud Messaging](https://developers.google.com/cloud-messaging/)
