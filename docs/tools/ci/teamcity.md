---
title: Использование команды города с Xamarin
description: В этом руководстве будут рассмотрены действия, связанные с помощью TeamCity для компиляции приложений для мобильных устройств и отправлять их в Xamarin Test Cloud.
ms.prod: xamarin
ms.assetid: AC2626CB-28A7-4808-B2A9-789D67899546
author: lobrien
ms.author: laobri
ms.date: 03/23/2017
ms.openlocfilehash: a3cb79f33b64d933aa8ab4d3555479cc16238992
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50118270"
---
# <a name="using-team-city-with-xamarin"></a>Использование команды города с Xamarin

_В этом руководстве будут рассмотрены действия, связанные с помощью TeamCity для компиляции приложений для мобильных устройств и отправлять их в Xamarin Test Cloud._

Как уже говорилось в [введение в непрерывную интеграцию](~/tools/ci/intro-to-ci.md) руководство, непрерывной интеграции (CI) очень полезно при разработке качественных мобильных приложений. Существует множество вполне жизнеспособными вариантами для непрерывной интеграции серверное программное обеспечение; в этом руководстве основное внимание уделяется [TeamCity](http://www.jetbrains.com/teamcity/) от компании JetBrains.

Существует несколько различных вариантов установки TeamCity. Ниже приведен список некоторых из них:

- **Службы Windows** — в этом случае TeamCity запуск при загрузке Windows как служба Windows. Должны быть связаны с узлом сборки Mac для компиляции приложений iOS.

- **Запуск управляющей программы в OS X** — по существу, это очень похоже на запуск в качестве службы Windows, описанных в предыдущем шаге. По умолчанию построения будет выполняться в учетной записи root.

- **Учетная запись пользователя в OS X** — можно запустить TeamCity с учетной записью пользователя, который запускается при каждом входе пользователя.

Из предыдущих сценариях TeamCity под управлением учетной записи пользователя в OS X — это самый простой и легкий в программу установки.

Существуют несколько шагов, связанные с настройкой TeamCity:

- **Установка TeamCity** — в этом руководстве не рассматривается установка TeamCity. В этом руководстве предполагается, что TeamCity установлен и запущен под учетной записью пользователя. Инструкции по [Установка TeamCity](http://confluence.jetbrains.com/display/TCD8/Installation) можно найти в [TeamCity 8 документации](http://confluence.jetbrains.com/display/TCD8/TeamCity+Documentation) , созданная JetBrains.

- **Подготовка сервера сборки** — этот шаг подразумевает установку необходимого программного обеспечения, средства, и сертификаты, необходимые для создания приложений для мобильных устройств и подготовки их к распространению.

- **Создание скрипта, создающего** — этот шаг не является обязательным, но скрипт сборки — это полезное средство для создания приложений в автоматическом режиме. С помощью сценария сборки помогут в устранении неполадок проблем сборки, которые могут возникнуть и предоставляет согласованный, повторяемый способ создания двоичные файлы для распространения, даже если непрерывной интеграции не практикуется.

- **Создание проекта TeamCity** — после завершения предыдущие три шага, необходимо создать проект TeamCity, который будет содержать все метаданные необходимые для получения исходного кода, компиляция проектов и отправка тесты в тестовом облаке Xamarin.

## <a name="requirements"></a>Требования

Благодаря [Xamarin Test Cloud](https://developer.xamarin.com/guides/testcloud) является обязательным.

Знакомство с TeamCity 8.1 является обязательным. Установка TeamCity выходит за рамки настоящего документа. Предполагается, что TeamCity устанавливается на OS X Mavericks и выполняется под учетной записью пользователя, а не учетной записи root.

Сервер сборки должен быть автономный компьютер, с OS X, который предназначен для непрерывной интеграции. В идеальном случае сервер сборки не будет отвечать за других ролей, например сервер базы данных, веб-сервере или рабочей станции разработчика.

> [!IMPORTANT]
> В этом руководстве не рассматривается в конфигурации «автономная» установки Xamarin.

[!include[](~/tools/ci/includes/firewall-information.md)]

## <a name="preparing-the-build-server"></a>Подготовка сервера сборки

Чтобы установить все необходимые средства, программное обеспечение и сертификаты для построения мобильных приложений является ключевым этапом при настройке сервера сборки. Важно, что сервер сборки можно компилировать мобильное решение и запустить все тесты. Чтобы свести к минимуму проблемы с конфигурацией, программному обеспечению и средствам должна устанавливаться в той же учетной записью, на котором размещается TeamCity. Ниже приведен список требований:

1. **Visual Studio для Mac** — Сюда входят Xamarin.iOS и Xamarin.Android.
2. **Войдите в Store компонента Xamarin** — это необязательный шаг и только требуется, если приложение использует компоненты в магазине компонентов Xamarin. Упреждающее ведение журнала в хранилище компонентов на этом этапе не позволит проблем при попытке построения TeamCity компиляции приложения.
3. **Xcode** – Xcode необходим для компиляции и входа приложения iOS.
4. **Средства командной строки Xcode** – это описано в шаге 1 раздела установки [обновление Ruby с rbenv](https://developer.xamarin.com/guides/testcloud/calabash/updating-ruby-using-rbenv/) руководства.
5. **Подписи удостоверения и профили подготовки** — импортировать сертификаты и подготовительный профиль с помощью XCode. См. в руководстве Apple [экспорт удостоверений подписи и профилей подготовки](https://developer.apple.com/library/ios/recipes/xcode_help-accounts_preferences/articles/export_signing_assets.html) для получения дополнительных сведений.
6. **Android Keystores** — скопируйте в каталог, что TeamCity пользователя есть доступ, т. е. требуется Android keystores `~/Documents/keystores/MyAndroidApp1`.
7. **Calabash** — это необязательный шаг, если приложение содержит тесты, написанные с использованием Calabash. См. в разделе [Calabash установке в OS X Mavericks](https://developer.xamarin.com/guides/testcloud/calabash/osx-installation/) руководство и [обновление Ruby с rbenv](https://developer.xamarin.com/guides/testcloud/calabash/updating-ruby-using-rbenv/) для дополнительных сведений.

Все эти компоненты на следующей схеме:

![](teamcity-images/image1.png "Схема иллюстрирует все эти компоненты")

После всего программного обеспечения, установки, войдите учетную запись пользователя и убедитесь, что все программное обеспечение правильно установлен и работает. Это должно включать компиляции решения и отправке приложения в Test Cloud. Это можно значительно упростить, выполнив скрипт сборки, как описано в следующем разделе.

## <a name="create-a-build-script"></a>Создать скрипт сборки

Несмотря на то, что это вполне возможно, для TeamCity для обработки всех аспектов компиляция и отправка мобильных приложений в Test Cloud сам по себе, настоятельно рекомендуется создать скрипт сборки. Скрипт сборки обеспечивает следующие преимущества:

1. **Документация по** — скрипт сборки служит в качестве формы документации на построение программного обеспечения. При этом удаляются некоторые «волшебных», связанные с развертыванием приложения и позволяет разработчикам сосредоточиться на функции.
1. **Повторяемость** — скрипт сборки гарантирует, что каждый раз, компиляции и развертывания, приложение, это происходит в точно так же, независимо от того, кто или что делает работу. Эта согласованность repeatable удаляет любые проблемы или ошибки, которые могут закрадываться в из-за неправильно выполненного построения или человеческих ошибок.
1. **Управление версиями** — скрипт сборки может быть включено в системе управления версиями. Это означает, что изменения в сценарий сборки отслеживаются, отслеживания и исправить при обнаружении ошибок или несоответствий.
1. **Подготовка среды** — скрипт сборки можно включить логику, чтобы установить все необходимые зависимости сторонних разработчиков. Это позволит гарантировать, что все компоненты, необходимые построение приложений.

Скрипт сборки может быть сложнее, чем файл Powershell (в Windows) или bash-скрипт (в OS X). При создании сценария сборки, существует несколько способов языки сценариев:

- [**Rake** ](https://github.com/jimweirich/rake) – это языка конкретного домена (DSL) для построения проектов, на основании Ruby. Rake имеет преимущество популярность и обширной экосистемой библиотеки.

- [**psake** ](https://github.com/psake/psake) — это библиотека Windows Powershell для создания программного обеспечения

- [**ИМИТИРОВАТЬ** ](http://fsharp.github.io/FAKE/) – это DSL на основе F# которого дает возможность использовать существующие библиотеки .NET, при необходимости.

Используемый язык сценариев зависит от ваших предпочтений и требований. [TaskyPro Calabash](https://github.com/xamarin/test-cloud-samples/tree/master/TaskyPro/TaskyPro-Calabash) пример содержит пример использования Rake как [скрипту сборки](https://github.com/xamarin/test-cloud-samples/blob/master/TaskyPro/TaskyPro-Calabash/Rakefile).

> [!NOTE]
> Это можно использовать систему сборки на основе XML, например MSBuild или NAnt, но эти отсутствие выразительность и удобства сопровождения DSL, предназначенный для создания программного обеспечения.

### <a name="parameterizing-the-build-script"></a>Параметризация скрипт сборки

Процесс построения и тестирования программного обеспечения требуются данные, которые должны храниться в секрете. В частности Создание пакета APK может требовать пароль для хранилища ключей и/или псевдоним ключа в хранилище ключей. Аналогичным образом Test Cloud требует наличия ключа API, которое является уникальным для разработчика. Эти типы значений не должны быть жестких закодированных в скрипте сборки. Вместо этого они должны передаваться как переменные в сценарий сборки.

Меньшую чувствительность — значения, такие как iOS идентификатор устройства или идентификатор устройства Android, определения устройств, которые должны использоваться Test Cloud для тестирования выполняется. Это не значения, которые должны быть защищены, но они могут изменить от сборки к сборке.

Хранение этих типов переменных за пределами скрипт сборки также облегчает поделиться скрипт сборки в организации, с разработчиками, например. Разработчики могут использовать тот же самый скрипт как сервер сборки, но можно использовать собственные keystores и ключи API.

Существует два возможных варианта для хранения этих конфиденциальных данных.

- **Файл конфигурации** — для защиты ключа API Cloud тестирования, это значение не должно проверяться в систему управления версиями. Файл может создаваться для каждого компьютера. Как значения считываются из этого файла зависит от язык сценариев.

- **Переменные среды** — их можно легко задать на уровне компьютера и щих независимо от используемого языка скриптов.

Существуют, преимущества и недостатки каждого из этих вариантов. TeamCity хорошо работает с переменными среды, поэтому в этом руководстве будет рекомендовать этот прием, создавая скрипты сборки.

### <a name="build-steps"></a>Этапы сборки

Скрипт сборки должен иметь возможность выполните следующие действия:

- **Скомпилируйте приложение** — Сюда входят, подписи приложения с нужный профиль подготовки.

- **Отправьте приложение в Xamarin Test Cloud** — Сюда входят подписи и zip, выравнивание пакета APK с помощью соответствующего хранилища ключей.

Следующие два действия будут рассматриваться более подробно ниже.

#### <a name="compiling-a-xamarinios-application"></a>Компиляция приложения Xamarin.iOS

[!include[](~/tools/ci/includes/commandline-compile-of-xamarin-ios-ipa.md)]

#### <a name="compiling-a-xamarinandroid-application"></a>Компиляция приложения Xamarin.Android

Чтобы скомпилировать приложение Android, используйте **xbuild** (или **msbuild** в Windows):

```bash
/Library/Frameworks/Mono.framework/Commands/xbuild /t:SignAndroidPackage /p:Configuration=Release /path/to/android.csproj
```

Обратите внимание, что для компиляции приложения Xamarin Android **xbuild** использует для сборки приложения iOS проекта, которые **xbuild** требует решения.

#### <a name="submitting-xamarinuitests-to-test-cloud"></a>Отправка Xamarin.UITests в Test Cloud

Тесты пользовательского интерфейса отправляются с использованием `test-cloud.exe` приложения, как показано в следующем фрагменте:

```bash
test-cloud.exe <path-to-apk-or-ipa-file> <test-cloud-team-api-key> --devices <device-selection-id> --assembly-dir <path-to-tests-containing-test-assemblies> --nunit-xml report.xml --user <email>
```

При выполнении теста результаты теста будет возвращаться в виде XML-файла NUnit стиль называется **report.xml**. TeamCity будет отображать сведения в журнале сборки.

Дополнительные сведения об отправке тестов пользовательского интерфейса в Test Cloud см. в этом руководстве в [Xamarin.UITests Подготовка к отправке](/appcenter/test-cloud/preparing-for-upload/uitest/).

#### <a name="submitting-calabash-tests-to-test-cloud"></a>Отправка Calabash тесты для проверки облака

Тесты Calabash отправляются с использованием `test-cloud` gem, как показано в следующем фрагменте:

```bash
test-cloud submit /path/to/APK-or-IPA <test-cloud-team-api-key> --devices <device-id> --user <email>
```
Чтобы отправить приложение Android в Test Cloud, бывает необходимо перестроить тестовый сервер APK, с помощью calabash android:

```bash
$ calabash-android build </path/to/signed/APK>
$ test-cloud submit /path/to/APK <test-cloud-team-api-key> --devices <ANDROID_DEVICE_ID> --profile=android --config=config/cucumber.yml --pretty
```
Дополнительные сведения об отправке тестов Calabash см. в руководстве по Xamarin на [Отправка Calabash тестов в Test Cloud](https://developer.xamarin.com/guides/testcloud/calabash/working-with/submitting-tests-to-xamarin-test-cloud/).

## <a name="creating-a-teamcity-project"></a>Создание проекта TeamCity

После установки TeamCity и проект Visual Studio для Mac можно построить, пришло время для создания проекта в TeamCity постройте проект и выполнить его в Test Cloud.

1. К работе, войдя в TeamCity в веб-браузере. Перейдите к корневой проект:

    ![Перейдите к корневой проект](teamcity-images/image2.png "перейдите к корневой проект") под корневой проект, создайте вложенный проект:

    ![Перейдите к корневой проект под корневой проект, создайте новый проект вложенных](teamcity-images/image3.png "Navigate в корень проекта под корневой проект, создайте новый проект вложенные")
2. После создания подпроекта, добавьте новую конфигурацию сборки:

    ![После создания подпроекта, добавьте новую конфигурацию построения](teamcity-images/image5.png "после создания подпроекта добавления новой конфигурации построения")
3. Вложение проекта VCS конфигурация сборки. Это делается с помощью экрана параметр параметров версии:

    ![Это делается с помощью версии управляющего параметра экрана](teamcity-images/image6.png "это делается с помощью экрана параметр управления версиями")

    Если проекта VCS еще не создан, вы можете создать его на странице новый корневой элемент VCS, показано ниже:

    ![Если проекта VCS еще не создан, вы можете создать его на странице новый корневой элемент VCS](teamcity-images/image7.png "Если проекта VCS еще не создан, вы можете создать его на странице новый корневой элемент VCS")

    После присоединения корневой VCS извлечения будет TeamCity проекта и повторите для автоматического обнаружения шаги сборки. Если вы знакомы с TeamCity, затем можно выбрать одно из действий, обнаруженных сборки. Его можно безопасно пропустить шаги обнаруженные сборки.

4. Настройте триггер построения. Это будет очередь сборки при определенных условий, например когда пользователь вносит код в репозиторий. Снимке экрана ниже показано, как добавить триггер построения:

    ![На этом снимке экрана показано, как добавить триггер построения](teamcity-images/image8.png "на этом снимке экрана показано, как добавить триггер построения") пример настройки триггера построения видно на следующем снимке экрана:

    ![Пример настройки триггера построения видно на следующем снимке экрана](teamcity-images/image9.png "на этом снимке экрана видно пример настройки триггера построения")

5. Выше, параметризация скрипт сборки, предлагаемые хранение некоторых значений в переменных среды. Эти переменные можно добавить к конфигурации построения с помощью параметров экрана. Добавьте переменные для ключа API облачного тестирования, идентификатор устройства iOS и Android идентификатор устройства, как показано на следующем снимке экрана:

    ![Добавьте переменные для ключа API облачного тестирования, идентификатор устройства iOS и Android идентификатор устройства](teamcity-images/image11.png "добавьте переменные для ключа API облачного тестирования, идентификатор устройства iOS и Android идентификатор устройства")

6. Последним шагом является добавление шага сборки, который будет вызывать скрипт сборки для компиляции приложения и постановки в очередь приложения в Test Cloud. Следующий снимок экрана является примером шаг сборки, который использует Rakefile для создания приложения:

    ![На этом снимке экрана приведен пример этапа построения, который использует для создания приложения Rakefile](teamcity-images/image12.png "на этом снимке экрана приведен пример этапа построения, который использует Rakefile для создания приложения")

7. На этом этапе Настройка построения завершена. Это хорошая идея инициировать создание сборки, чтобы убедиться, что проект правильно настроен. Хороший способ сделать это заключается в фиксации Мелкая "," незначительные изменения в репозиторий. TeamCity следует обнаружить фиксацию и начать сборку.

8. После завершения построения просмотрите журнал сборки и вы увидите, если есть проблемы или предупреждений с помощью сборки, которые требуют внимания.

## <a name="summary"></a>Сводка

В этом руководстве рассматривается использование TeamCity для создания приложений Xamarin Mobile и их отправки в Test Cloud. Мы говорили о создании скрипт сборки для автоматизации процесса сборки. Скрипт сборки берет на себя при компиляции приложения, отправка в Test Cloud и ожидания результатов

Затем мы рассмотрели, как создать проект в TeamCity, будут заноситься в очередь сборки каждый раз, когда разработчик фиксации кода и будет вызывать сценарий сборки.

## <a name="related-links"></a>Связанные ссылки

- [Подготовка Xamarin.UITests зарегистрированном передачи](/appcenter/test-cloud/preparing-for-upload/uitest/)
- [Установка и настройка TeamCity](http://confluence.jetbrains.com/display/TCD8/Installing+and+Configuring+the+TeamCity+Server)
