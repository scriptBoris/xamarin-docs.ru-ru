---
title: Повышение частоты кадров с помощью CCSpriteSheet
description: Помощью CCSpriteSheet предоставляет функциональные возможности для объединения и с помощью многих файлов изображений в одну текстуру. Уменьшая число текстуры повышает время загрузки игр и частоте кадров.
ms.prod: xamarin
ms.assetid: A1334030-750C-4C60-8B84-1A8A54B0D00E
author: conceptdev
ms.author: crdun
ms.date: 03/24/2017
ms.openlocfilehash: eab6153653a8c8df2068aaaf879d84d35473c541
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50123572"
---
# <a name="improving-frame-rate-with-ccspritesheet"></a>Повышение частоты кадров с помощью CCSpriteSheet

_Помощью CCSpriteSheet предоставляет функциональные возможности для объединения и с помощью многих файлов изображений в одну текстуру. Уменьшая число текстуры повышает время загрузки игр и частоте кадров._

Многие игры требуют попытки по оптимизации для стабильной работы и скорость загрузки на мобильных устройствах. `CCSpriteSheet` Класс может помочь устранить многие распространенные проблемы производительности, испытываемых CocosSharp игры. В этом руководстве рассматриваются распространенные проблемы производительности и способы их устранения с помощью `CCSpriteSheet` класса.


## <a name="what-is-a-sprite-sheet"></a>Что такое спрайт листа?

Объект *лист спрайт*, которой может также называться *атлас текстур*, — это образ, который объединяет несколько образов в один файл. Это может повысить производительность во время выполнения, а также время загрузки содержимого.

Например на следующем рисунке представлен простой спрайт листа, созданные три отдельных образа. Отдельные образы могут быть любого размера, и окно итоговый спрайт не должен заполняться полностью:

![](ccspritesheet-images/image1.png "Отдельные образы могут быть любого размера, и окно итоговый спрайт не должен заполняться полностью")


### <a name="render-states"></a>Отображения состояния

Визуальные объекты CocosSharp (такие как `CCSprite`) упростить код отрисовки по сравнению с традиционной графический кодом отрисовки API например MonoGame или OpenGL, которые требуют создания буферы вершин (как описано в [рисования трехмерной графики с Вершин в MonoGame](~/graphics-games/monogame/3d/part2.md) руководстве). Несмотря на его простоте CocosSharp не устраняет затраты на параметр *визуализации состояния*, которые представляют собой количество раз, что код отрисовки необходимо перейти, текстуры и другие состояния, относящиеся к визуализации.

Внутренний код в CocosSharp отображает каждый визуальный элемент последовательно, путем обхода визуального дерева, начиная с текущим `CCScene`. Например рассмотрим следующие сцены:

![](ccspritesheet-images/image2.png "Рассмотрите возможность этой сценой")

CocosSharp умеет отрисовывать четырех звездочек в последовательности:

![](ccspritesheet-images/image3.png "CocosSharp умеет отрисовывать четырех звездочек в последовательности")

Поскольку каждое `CCSprite` использует той же текстуры, CocosSharp можно сгруппировать все четыре звезды. Этот код требует только один отрисовки состояние назначения (назначение типа "звезда" текстуры) каждого кадра. Этот сценарий является очень эффективным.

Само собой очень мало игр используется только один образ. Следующие сцены появились рисунка планеты.

![](ccspritesheet-images/image4.png "Этой сценой представляет графическое планеты")

В идеале CocosSharp должен рисоваться все спрайты, используя один образ сначала (например звезд), а затем остальная часть спрайты, с помощью другого изображения (планета):

![](ccspritesheet-images/image5.png "В идеале CocosSharp должен рисоваться все спрайты, сначала с помощью одного образа, например звезд, а затем остальная часть спрайты, с помощью другого изображения планете")

Порядок выше требует двух визуализации состояния: одно для типа "звезда", первый в мире первого.

Если все `CCSprite` экземпляры являются дочерними элементами одной и той же `CCNode`, то CocosSharp будет оптимизировать порядок рисования, чтобы уменьшить изменения состояния отображения. Если, с другой стороны, `CCSprite` экземпляров упорядочены таким образом, CocosSharp не позволяет оптимизировать отрисовку (например, если они являются частью другой сущности `CCNode` экземпляров), то порядок не будет оптимальной. Ниже показан порядок наихудшее возможных draw, приводит пять состояний визуализации:

![](ccspritesheet-images/image6.png "Это показывает наихудшее порядок возможных draw, приводит к пяти состояния визуализации")

Состояния визуализации может быть трудно оптимизации, так как порядок рисования должен подчиняться визуальное дерево элемента `CCNode` экземпляров. Это дерево является часто структурированные быть легко работать с (такие как сущности, содержащий их визуальных дочерних элементов) или их организации из-за раскладку visual согласно исполнителя.

Само собой идеальная ситуация является состояние одной визуализации, несмотря на наличие нескольких образов. Игры CocosSharp достигается путем объединения всех образов в один файл, то загрузка файлов (вместе с его описанием **.plist** файл) в `CCSpriteSheet`. С помощью `CCSpriteSheet` класс становится еще более важно для игр, которые имеют большое количество изображений или которые имеют очень сложных макетов. 

### <a name="load-times"></a>Время загрузки

Объединение нескольких образов в один файл также улучшает время загрузки игр по ряду причин:

 - Объединение нескольких образов в одном файле может снизить общее количество пикселей, с помощью более эффективной упаковки
 - Загрузка меньшее количество файлов означает меньше издержек каждого файла, например анализе заголовков .png
 - Загрузка меньшее количество файлов требует меньше время, что важно для дисковые носители, такие как DVD-дисков и жестких дисках компьютера традиционных поиска

## <a name="using-ccspritesheet-in-code"></a>С помощью помощью CCSpriteSheet в коде

Чтобы создать `CCSpriteSheet` экземпляра, код необходимо указать образ и файл, который определяет области на изображение, используемое для каждого кадра. Изображение можно загрузить в качестве **.png** или **.xnb** файла (при использовании [конвейера содержимого](~/graphics-games/cocossharp/content-pipeline/index.md)). Файл, определяющий кадры — **.plist** файла, которые могут быть созданы вручную или *TexturePacker* (который мы обсудим далее).

Пример приложения, который [можно загрузить здесь](https://developer.xamarin.com/samples/mobile/SpriteSheetDemo/), создает `CCSpriteSheet` из **.png** и **.plist** файл, используя следующий код:

```csharp
CCSpriteSheet sheet = new CCSpriteSheet ("sheet.plist", "sheet.png"); 
```

После загрузки `CCSpriteSheet` содержит `List` из `CCSpriteFrame` экземпляров — каждого экземпляра, соответствующий одному из исходного изображения, используемые для создания весь лист. В случае использования **SpriteSheetDemo** проекта, `CCSpriteSheet` содержит три изображения. **.Plist** файл можно просмотреть в Visual Studio для Mac или в любом текстовом редакторе, чтобы увидеть, какие образы доступны. Если просмотреть **.plist** файл в текстовом редакторе, мы видим три кадров (разделов опущены, чтобы выделить имена ключей):


```csharp
...
<dict>
    <key>frames</key>
    <dict>
        <key>farBackground.png</key>
        ...
        <key>foreground.png</key>
        ...
<key>forestBackground.png</key>
...
```

Мы можем использовать `Find` способ поиска кадров по имени, как показано ниже (указан код подчеркнуть `CCSpriteFrame` использования):


```csharp
CCSpriteFrame frame;
...
frame = sheet.Frames.Find(item=>item.TextureFilename == "farBackground.png"); 
CCSprite sprite = new CCSprite (frame); 
...
```

Так как `CCSprite` конструктор может занять `CCSpriteFrame` параметр, код никогда не должен изучить аспекты `CCSpriteFrame`, например какая текстура используется, или в регионе образа на листе master спрайт.


## <a name="creating-a-sprite-sheet-plist"></a>Создание листа спрайт .plist

Plist-файл является xml-файл, который можно создавать и изменять вручную. Аналогичным образом программ для редактирования изображений можно использовать для объединения нескольких файлов в один файл большего размера. С момента создания и обслуживания, что спрайт листы может занять очень много времени, мы рассмотрим TexturePacker программы, в которой можно экспортировать в формате CocosSharp. TexturePacker предлагает бесплатную и «Pro» версии и доступна для Windows и Mac OS. Далее в этом руководстве может следовать в бесплатной версии. 

Может быть TexturePacker [загрузить с веб-сайта TexturePacker](https://www.codeandweb.com/texturepacker). При открытии TexturePacker не загружен проект. Начальный экран позволяет добавить спрайты, откройте последние проекты (если они были созданы другие проекты) и выберите формат, используемый для листа спрайт. CocosSharp использует формат данных Cocos2D:

![](ccspritesheet-images/image7.png "Использует формат данных Cocos2D, CocosSharp")

Файлы изображений (такие как **.png**) могут добавляться к TexturePacker путем перетаскивания их из проводника Windows в Windows или поиска на компьютере Mac. TexturePacker автоматически обновляет лист спрайт предварительной версии, при каждом добавлении файла:

![](ccspritesheet-images/image8.png "TexturePacker автоматически обновляет предварительного просмотра таблицы стилей спрайт при каждом добавлении файла")

Чтобы экспортировать таблицу спрайта, щелкните **лист спрайт публикации** кнопку и выберите расположение для листа спрайт. TexturePacker сэкономит plist-файл и файл изображения.

Чтобы использовать полученные файлы, добавьте в проект CocosSharp PNG и plist-файл. Сведения о добавлении файлов в проекты CocosSharp, см. в разделе [руководство по игре BouncingGame](~/graphics-games/cocossharp/bouncing-game.md). Когда добавляются файлы, они могут быть загружены `CCSpriteSheet` как было показано ранее в приведенном выше коде:

```csharp
CCSpriteSheet sheet = new CCSpriteSheet ("sheet.plist", "sheet.png"); 
```

### <a name="considerations-for-maintaining-a-texturepacker-sprite-sheet"></a>Рекомендации в отношении обслуживания лист спрайт TexturePacker

Мере разработки игр, исполнителей могут добавлять, удалять или изменять art. После любого изменения необходимо лист обновленные спрайт. Приведенные ниже аспекты можно упростить обслуживание спрайт таблицы стилей:

 - Сохранить исходные файлы (файлы, используемые для создания таблицы спрайта) в папке проекта и убедитесь, что они добавляются в систему управления версиями. Эти файлы потребуется для повторного создания таблицы спрайт при каждом изменении.
 - Следует добавить исходных файлов в Visual Studio для Mac или Visual Studio, или если они были добавлены, устанавливать **действие при построении** для **None**. Если файлы добавляются и у конкретных платформ **действие при построении**, то они будут без необходимости увеличить размер файла результирующего приложения.
 - Рассмотрите возможность использования *смарт-папок* в TexturePacker. Смарт-папки автоматически добавляет все образы, содержащиеся в лист спрайт. Эта возможность позволяет сэкономить много времени, когда Разработка игр с большим числом образов. 

    ![](ccspritesheet-images/image9.png "Эта возможность позволяет сэкономить много времени, когда Разработка игр с большим числом образов")
 - Обратите внимание на размеры текстуры спрайт. Более старым оборудованием телефона не поддерживает размеры текстуры, размер которых превышает 2048 x 2048. Кроме того 32-разрядного образа 2048 x 2048 использует около 17 МБ ОЗУ — значительный объем памяти.
 - TexturePacker не включает папки в спрайт имена по умолчанию, поэтому возможны конфликты имен. Рекомендуется решить, чтобы включить папку имена или не в начале разработки. Больше игр следует использовать имена папок для предотвращения конфликтов. Чтобы включить пути к папкам, выберите **Показать расширенные параметры** в **данных** и установите **добавленное имя папки**. 

    ![](ccspritesheet-images/image10.png "Чтобы включить пути к папкам, нажмите кнопку Показать расширенные параметры в разделе данных и проверить добавленное имя папки")

## <a name="summary"></a>Сводка

В этом руководстве описывается, как создать и использовать `CCSpriteSheet` класса. Здесь также рассматривается, как для создания файлов, которые могут быть загружены в `CCSpriteSheet` экземпляры с помощью программы TexturePacker.

## <a name="related-links"></a>Связанные ссылки

- [Помощью CCSpriteSheet](https://developer.xamarin.com/api/type/CocosSharp.CCSpriteSheet/)
- [Полным демонстрационным (пример)](https://developer.xamarin.com/samples/mobile/SpriteSheetDemo/)
